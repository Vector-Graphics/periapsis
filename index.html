<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <title>My Website</title>
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Metrophobic">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Orbitron">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Comfortaa">
    <style>
  :root {
    --textcolor: rgb(255,255,255);
            --textcolorb: rgb(255,255,255);        
            --bgcolor: rgb(0, 0, 19);
            --btncolorpressed: rgb(0, 16, 160);
            --btncolor: rgb(0, 64, 202);
            --btncolorhover: rgb(0, 86, 214);
            --scrollcolor: rgb(0, 38, 141);
            --insetcolor:rgb(0, 8, 41);
            --typeg:rgb(255,255,255);
            --typef:#c0e8ff;
            --typek:#fff0c1;
            --yellow: #ffd636;
            --cyan: #51e9f4;
            --lightgreen: #7fed56;
            --typea: #89d4ff;
            --innershadowcolor: #0084ff1f;
            --innershadowcolorb: #00ccff1f;
            --borderradiusdf: 8px;
            --whiteiconfilter: none;
            --font: Comfortaa, sans-serif;
            --hfont: Comfortaa, sans-serif;
            /**--textcolor: rgb(255,255,255);
            --textcolorb: rgb(255,255,255);    
            --bgcolor: rgb(16,16,16);
            --btncolorpressed: rgb(48,48,48);
            --btncolor: rgb(64,64,64);
            --btncolorhover: rgb(96,96,96);
            --scrollcolor: rgb(96,96,96);
            --insetcolor:rgb(32,32,32);
            --typeg:rgb(255,255,255);
            --typef:#c0e8ff;
            --typek:#fff0c1;
            --yellow: #ffd636;
            --cyan: #51e9f4;
            --lightgreen: #7fed56;
            --typea: #89d4ff;
            --innershadowcolor: #0000004F;
            --innershadowcolorb: #0000001F;
            --borderradiusdf: 15px;
            --whiteiconfilter: none;
            --font: Metrophobic, sans-serif;
            --hfont: Eras BQ, sans-serif;**/

        }
        [data-theme="light"] {
            --textcolor: rgb(0,0,0);
            --textcolorb: rgb(0,0,0);    
            --bgcolor: rgb(250,250,250);
            --btncolorpressed: rgb(160,160,160);
            --btncolor: rgb(192,192,192);
            --btncolorhover: rgb(240,240,240);
            --scrollcolor: rgb(158, 158, 158);
            --insetcolor:rgb(240,240,240);
            --typek:#beab71;
            --typeg:rgb(140,140,140);
            --typef:rgb(140,150,160);
            --typea: #72aed1;
            --yellow: #b89b29;
            --cyan: #22bac5;
            --lightgreen: #53d822;
            --innershadowcolor: #0000004F;
            --innershadowcolorb: #0000001F;
            --borderradiusdf: 15px;
            --whiteiconfilter: brightness(0);
            --font: Metrophobic, sans-serif;
            --hfont: Eras BQ, sans-serif;
        }
        [data-theme="green"] {
            --textcolor: rgb(255, 255, 255);
            --textcolorb: rgb(255,255,255);    
            --bgcolor: rgb(0, 0, 0);
            --btncolorpressed: rgb(0, 59, 3);
            --btncolor: rgb(0, 83, 4);
            --btncolorhover: rgb(0, 104, 5);
            --scrollcolor: rgb(0, 128, 11);
            --insetcolor:rgb(0, 26, 4);
            --typeg:rgb(255,255,255);
            --typef:#c0e8ff;
            --typek:#fff0c1;
            --yellow: #ffd636;
            --cyan: #51e9f4;
            --lightgreen: #7fed56;
            --typea: #89d4ff;
            --innershadowcolor: #FFFFFF00;
            --innershadowcolorb: #FFFFFF00;
            --borderradiusdf: 0px;
            --whiteiconfilter: none;
            --font: monospace;
            --hfont: Orbitron, sans-serif;
        }
        [data-theme="red"] {
            --textcolor: rgb(255,255,255);
            --textcolorb: rgb(255,255,255);    
            --bgcolor: rgb(15, 0, 0);
            --btncolorpressed: rgb(53, 0, 0);
            --btncolor: rgb(66, 0, 0);
            --btncolorhover: rgb(95, 0, 0);
            --scrollcolor: rgb(99, 0, 0);
            --insetcolor:rgb(41, 0, 0);
            --typeg:rgb(255,255,255);
            --typef:#c0e8ff;
            --typek:#fff0c1;
            --yellow: #ffd636;
            --cyan: #51e9f4;
            --lightgreen: #7fed56;
            --typea: #89d4ff;
            --innershadowcolor: #0000004F;
            --innershadowcolorb: #0000001F;
            --borderradiusdf: 15px;
            --whiteiconfilter: none;
            --font: Metrophobic, sans-serif;
            --hfont: Eras BQ, sans-serif;

        }
        [data-theme="2048"] {
            --textcolor: #faf8ef;
            --textcolorb: #776e65;
            --bgcolor: #faf8ef;
            --btncolorpressed: #8f7a66;
            --btncolor: #8f7a66;
            --btncolorhover: #8f7a66;
            --scrollcolor: rgb(158, 158, 158);
            --insetcolor:#eee1c9;
            --typek:#beab71;
            --typeg:rgb(140,140,140);
            --typef:rgb(140,150,160);
            --typea: #72aed1;
            --yellow: #b89b29;
            --cyan: #22bac5;
            --lightgreen: #53d822;
            --innershadowcolor: #FFFFFF00;
            --innershadowcolorb: #FFFFFF00;
            --borderradiusdf: 5px;
            --whiteiconfilter: brightness(0);
            --font: sans-serif;
            --hfont: sans-serif;
        }
        [data-theme="midnight"] {
            --textcolor: #ffffff;
            --textcolorb: #ffffff;
            --bgcolor: #000000;
            --btncolorpressed: #000000;
            --btncolor: #000000;
            --btncolorhover: #000000;
            --scrollcolor: rgb(35, 0, 58);
            --insetcolor:#000000;
            --typek:#beab71;
            --typeg:rgb(140,140,140);
            --typef:rgb(140,150,160);
            --typea: #72aed1;
            --yellow: #b89b29;
            --cyan: #22bac5;
            --lightgreen: #53d822;
            --innershadowcolor: #FFFFFF00;
            --innershadowcolorb: #FFFFFF00;
            --borderradiusdf: 5px;
            --whiteiconfilter: none;
            --font: Metrophobic, sans-serif;
            --hfont: Eras BQ, sans-serif;
        }
        p {
            font-family: var(--font);
            font-weight:bold;
            font-size: larger;
            color: var(--textcolorb);
            
        }
        #pagenumber {
            font-family: var(--font);
            font-weight:bold;
            font-size: larger;
            color: var(--textcolor);
            text-align: center;
        }
        .systemcontainer p {
            color: var(--textcolorb);
            vertical-align: middle;
        }
        #pagenumber {
            color: var(--textcolorb);
        }

        .patchnotes {
            text-align: center;
        }

        h3 {
            font-family: var(--font);
            font-weight:bold;
            font-size: x-large;
            color: var(--textcolorb);
        }
        .systemcontainer h3 {
            color: var(--textcolorb);
            vertical-align: middle;
        }

        h1 {
            font-family: var(--hfont);
            color: var(--textcolorb);
            font-size: 50;
            text-align: center;
        }
        .infocontainer h1 {
            font-family: var(--hfont);
            color: var(--textcolorb);
            font-size: 50;
            text-align: center;
        }
        html {
            background-color: var(--bgcolor);
            transition: 0.15s;
        }
        body {
            width: 80%;
            margin-left: 20%;
            overflow-y: scroll;
            overflow-x: scroll;
            margin-right: 0px;
            
        }
        .main {
            width: 92%;
            margin: auto;
            
            left:25%;
            height:auto;
            overflow-x: scroll;
            overflow-y: scroll;
        }
        hr{
            color:var(--textcolor);
            border-color:var(--textcolor);

        }
        .systemcontainer hr {
            border-color: var(--textcolor);
        }
        .genbutton {
            background: var(--btncolor);
            padding:10px;
            padding-right:15px;
            padding-left:15px;
            display: block;
            margin: auto;
            width:80%;
            font-family: var(--font);
            font-weight:bold;
            font-size: 1.25em;
            color: var(--textcolor);
            border: 0px;
            border-radius: var(--borderradiusdf);
            cursor: pointer;
            transition: 0.15s;
            height: auto;
            
            box-shadow: inset -8px -8px 16px  var(--innershadowcolorb);
            text-wrap:nowrap
        }
        .genbutton3 {
            background: var(--insetcolor);
            padding:10px;
            padding-right:15px;
            padding-left:15px;
            display: block;
            margin: auto;
            width:80%;
            font-family: var(--font);
            font-weight:bold;
            font-size: 1.25em;
            color: var(--textcolor);
            border: 0px;
            border-radius: var(--borderradiusdf);
            cursor: text;
            transition: 0.15s;
            height: auto;
            box-shadow: inset -8px -8px 16px  var(--innershadowcolorb);
        }
        .genbutton:hover {
            background: var(--btncolorhover);
            font-size: 1.3em;

        }
        .genbutton:active {
            background: var(--btncolorpressed);
            font-size: 1.2em;
        }
        input::file-selector-button {
            background: var(--btncolor);
            padding:10px;
            padding-right:15px;
            padding-left:15px;
            display: block;
            margin: auto;
            width:80%;
            font-family: var(--font);
            font-weight:bold;
            font-size: 1.25em;
            color: var(--textcolor);
            border: 0px;
            border-radius: var(--borderradiusdf);
            cursor: pointer;
            transition: 0.15s;
            height: 80px;
            box-shadow: inset -8px -8px 16px  var(--innershadowcolorb);
        }
        input::file-selector-button:hover {
            background: var(--btncolorhover);
            font-size: 1.3em;

        }
        input::file-selector-button:active {
            background: var(--btncolorpressed);
            font-size: 1.2em;
        }
        .genbutton2 {
            background: var(--btncolor);
            padding:30px;
            padding-right:0px;
            padding-left:0px;
            display: block;
            margin: auto;
            width:80%;
            height: 150px;
            font-family: var(--font);
            font-weight:bold;
            font-size: xx-large;
            color: var(--textcolor);
            border: 0px;
            border-radius: var(--borderradiusdf);
            cursor: pointer;
            transition: 0.15s;
            box-shadow: inset -8px -8px 16px  var(--innershadowcolorb);
        }
        .genbutton2:hover {
            background: var(--btncolorhover);
            
            font-size: 2.1em;
        }
        .genbutton2:active {
            background: var(--btncolorpressed);
            font-size: 1.9em;
        }
        .pagebutton {
            background: var(--btncolor);
            padding:0px;
            display: inline;
            width:40px;
            font-family: var(--font);
            font-weight:bold;
            font-size: 1.25em;
            color: var(--textcolor);
            border: 0px;
            border-radius: var(--borderradiusdf);
            cursor: pointer;
            transition: 0.15s;
            height: 40px;
            box-shadow: inset -8px -8px 16px  var(--innershadowcolorb);
        }
        .titleimg{
            margin: 0 auto;
            width: 80%;
            display:block;
        }
        .infocontainer{
            scrollbar-width:thin;
            scrollbar-color:var(--bgcolor),var(--scrollcolor);
            overflow-y:scroll; 
            overflow-x:hidden;
            height:1000px; 
            background: var(--insetcolor);
            padding: 15px;
            width: 80%;
            margin: auto;
            border-radius: var(--borderradiusdf);
            box-shadow: inset 8px 8px 16px  var(--innershadowcolor);
            transition: 0.15s;
        }
        .system{
            scrollbar-width:thin;
            scrollbar-color:var(--bgcolor),var(--scrollcolor);
            overflow-y:scroll; 
            overflow-x:hidden;
            height:1000px; 
            background: var(--insetcolor);
            padding: 15px;
            border-radius: var(--borderradiusdf);
            box-shadow: inset 8px 8px 16px  var(--innershadowcolor);
            transition: 0.15s;
        }
        .system2{
            scrollbar-width:thin;
            scrollbar-color:var(--bgcolor),var(--scrollcolor);
            
            overflow-x:hidden;
            
            background: var(--insetcolor);
            padding: 15px;
            border-radius: var(--borderradiusdf);
            box-shadow: inset 8px 8px 16px  var(--innershadowcolor);
            transition: 0.15s;
        }
        #csvout p {
            font-family: monospace;
            font-size: medium;
        }
        a{
            color:rgb(0, 127, 255);
        }
        .systemcontainer{
            height: auto;
            background-color:rgb(0,0,0);
            border-radius: var(--borderradiusdf);
            transition: 0.15s;
        }

        .systemcontainerinterior{
            height: auto;
            background-color:rgb(0,0,0);
            border-radius: var(--borderradiusdf);
            transition: 0.15s;
        }
        ::-webkit-scrollbar {
            width: 8px;
            min-width: 8px;

        }
        ::-webkit-scrollbar-track {
            background-color:var(--bgcolor)
        }
        ::-webkit-scrollbar-thumb {
            background-color:var(--scrollcolor);
            border-radius:var(--borderradiusdf);
        }
        .red {
            color: #ff4500
        }
        .orange {
            color: #ffa800
        }
        .yellow {
            color: var(--yellow);
        }
        .darkgreen {
            color: #00a468
        }
        .lightgreen {
            color: var(--lightgreen)
        }
        .darkblue {
            color: #235083
        }
        .blue {
            color: #368fe9
        }
        .lightblue {
            color: var(--cyan)
        }
        .darkpurple {
            color: #811e9f
        }
        .purple {
            color: #b34ac0
        }
        .pink {
            color: #ff98a9
        }
        .brown {
            color: #9c6927
        }
        .black {
            color: #000000
        }
        .darkgray {
            color: #898d90
        }
        .lightgray {
            color: #d3d7da
        }
        .white {
            color: #ffffff
        }
        .typem {
            color: #ffb34f
        }
        .typek {
            color: var(--typek)
        }
        .typeg {
            color: var(--typeg);
        }
        .typef {
            color: var(--typef);
        }
        .typea {
            color: var(--typea);
        }
        .typeb {
            color: #4aa8ff
        }
        .typewd {
            color: var(--lightgreen);
        }
        .water {
            color: #727bff
        }
        .methanum {
            color: #a0a0a0
        }
        .wsubglacial {
            color: #92fbff
        }
        .ammonia {
            color: #c9cf70
        }
        .nitrogen {
            color: #7eff84
        }
        .rocky {
            color: rgb(158, 131, 103)
        }
        .icy {
            color: rgb(132, 171, 211)
        }
        .carbonaceous {
            color: rgb(219, 109, 57)
        }
        .metallic {
            color: rgb(159, 168, 168)
        }
        .icegiant {
            color: rgb(87, 156, 224)
        }
        .gasgiant {
            color: rgb(210,160,110)
        }
        .icon {
            height: 32px;
            padding: 0px;
            vertical-align: middle;
        }
        .whiteicon {

            filter: var(--whiteiconfilter);
        }
        .icon2 {
            height: 64px;
            padding: 0px;
            vertical-align: middle;
        }
        .navbar {
  height: 100%; /* Full-height: remove this if you want "auto" height */
  width: 20%; /* Set the width of the sidebar */
  position: fixed; /* Fixed Sidebar (stay in place on scroll) */
  z-index: 1; /* Stay on top */
  top: 0; /* Stay at the top */
  left: 0;
  overflow-x: hidden; /* Disable horizontal scroll */
  padding-top: 20px;
}
    .systemdisplay {
        width: 100%;
        border-radius: 16px;
        background-image: url("img/bgstars.png");
        background-size: 2048px;
        position:relative;
        display:block;
    }
    .planetdisplay {
        width: 256px;
        height: 256px;
        border-radius: 16px;
        position:relative;
        
        background-position: center;
        background-repeat: no-repeat;

    }
    .planetbg {
        background:black;
    }
    .planetoverlay {
        width: 256px;
        height: 256px;
        border-radius: 16px;
        
        top:0%;
        left:0%;
        background-position: center;
        background-repeat: no-repeat;
        position: absolute;

    }
    .planetscan {
        font-family: 'Consolas', 'Courier New', Courier, monospace;
        border-radius: var(--borderradiusdf);
            box-shadow: inset 8px 8px 16px  var(--innershadowcolor);
            background: var(--bgcolor);
            padding: 30px;
    }
    .planetscan p {
        font-family: 'Consolas', 'Courier New', Courier, monospace;
        
    }
    .switch {
  position: relative;
  display: block;
  margin: auto;
  width: 60px;
  height: 34px;
}

/* Hide default HTML checkbox */
.switch input {
  opacity: 0;
  width: 0;
  height: 0;
}

/* The slider */
.slider {
  position: absolute;
  cursor: pointer;
  top: 0;
  left: 0;
  right:0;
  bottom: 0;
  background-color: #ccc;
  -webkit-transition: .4s;
  transition: .4s;
}

.slider:before {
  position: absolute;
  content: "";
  height: 26px;
  width: 26px;
  left: 4px;
  bottom: 4px;
  background-color: white;
  -webkit-transition: .4s;
  transition: .4s;
}

input:checked + .slider {
  background-color: #2196F3;
}

input:focus + .slider {
  box-shadow: 0 0 1px #2196F3;
}

input:checked + .slider:before {
  -webkit-transform: translateX(26px);
  -ms-transform: translateX(26px);
  transform: translateX(26px);
}

/* Rounded sliders */
.slider.round {
  border-radius: 34px;
}

.slider.round:before {
  border-radius: 50%;
} 
        
    </style>
  </head>
  <body>
    <main>
        <body>
            <div class="navbar">
            <img class="titleimg" src="img/titleimg.png">
            <h1> v0.4022 Eridanus </h1>
            <hr>
            <h3 class="patchnotes">System Generation</h3>
        
            <!--<p class="patchnotes">Number of systems to generate</p>
            
            <p></p>
            <button onClick="GenerateSector(document.getElementById('numsystemsInput').value);" disabled="disabled" class="genbutton2">Generate!</button>
            <p></p>-->

            <button onClick="Test();" class="genbutton2">Generate!</button>
            <p class="patchnotes">Seed (leave blank to use random seed)</p>
            <input type="text" class="genbutton3" style="text-align:center;" placeholder="Seed (blank to use random seed)" id="seedinput">
            <p class="patchnotes">Force habitable planet</p>
            <label class="switch patchnotes">
                <input type="checkbox" id="forceTerrestrialPlanet">
                <span class="slider round patchnotes"></span>
            </label>
            <p class="patchnotes">Chance of life on habitable planets (0 = never, 1 = always)</p>
            <input type="text" class="genbutton3" style="text-align:center;" placeholder="Number of systems to generate" value="0.8" id="lifeChance">
            <a href="https://github.com/Vector-Graphics/periapsis/wiki/How-To-Customize-a-Periapsis-System" class="patchnotes" target="_blank" rel="noopener noreferrer"><p>Learn how to make your own systems! (Link)</p></a>
            <!--<p></p>

            <p></p>
            <p class="patchnotes">Systems generated:</p>
            <p class="progress patchnotes"></p>-->
            <hr>
            <p></p>
            <h3 class="patchnotes">Other</h3>
            <p class="patchnotes">Calculators</p>
            <!--<button onClick="switchTheme();" class="genbutton">Switch theme</button>-->
            <p></p>
            <hr>
            <p></p>
            <div class="infocontainer" style="overflow-y:scroll; height:500px;">
         
                <h1 class="patchnotes"> PATCHNOTES</h1>
                <h3 class="patchnotes">0.4022 beta</h3>
                <p class="patchnotes">- added link to the new custom system guide</p>
                <p class="patchnotes">- renamed "Force terrestrial planet" to "Force habitable planet" to make it clearer what it does</p>
                <h3 class="patchnotes">0.4021 beta | Eridanus</h3>
                <p class="patchnotes">- added atmosphere and temperature simulation!</p>
                <p class="patchnotes">- added surface liquids</p>  
                <p class="patchnotes">- added geological activity and life</p>  
                <p class="patchnotes">- civs added, and are now more common the older the planet is, as a simulation of the 'sapiozoic' phenomenon theorized by Leriendil where civilizational influence 'builds up' on the planet over time</p> 
                <p class="patchnotes">- added seeds (pseudorandom generation) (unrelated to seeds (botany)) - system's seed is now logged to console</p> 
                <p class="patchnotes">- added a tickbox to force the generation of systems with habitable worlds</p>
                <p class="patchnotes">- greatly improved visuals for planets</p>
                <p class="patchnotes">- added random name generation (the same as walkersysgen), Salibe is now the placeholder name for when a planet is unnamed</p>
                <p class="patchnotes">- buttons made a lot more compact</p>
                <p class="patchnotes">- fixed years</p>
                <h3 class="patchnotes">0.4011 alpha | Gemini: </h3>
                <p class="patchnotes">- system diagrams! (Shows all current info on each planet)</p>
                <p class="patchnotes">- binary and even triple stars!</p>
                <p class="patchnotes">- full JSON editing, customization, download and upload support (ripped from the original walkersysgen)</p>
                <p class="patchnotes">- no longer in pre-alpha</p>
            <h3 class="patchnotes">v0.4001 alpha | Orion:</h3>
            <p class="patchnotes">- pre-alpha generator released</p>
            <p class="patchnotes">- doesn't even have a system diagram yet smh</p>
            <p class="patchnotes">- and all the planets are named Salibe, what kinda generator is this</p>
            <hr>
            <h1 class="patchnotes"> COMING SOON</h1>  
            <h3 class="patchnotes">0.4031 | Horologium - planned features: </h3>
            <p class="patchnotes">- planetary rings</p>
            <p class="patchnotes">- rotation periods and tidal locking</p>
            <p class="patchnotes">- binary planets and unterplanets</p>   
            <p class="patchnotes">- hopefully full release of 0.5 at this point, depends on what I remember to add</p>   
            </div>
            <p></p>
            <div class="infocontainer" style="overflow-y:scroll; height:500px;">
                <h1 class="patchnotes">FAQ</h1>
                <h3 class="patchnotes">Where are the save/load options?</h3>
                <p class="patchnotes">Show the JSON editor, that will reveal them. The save/load options now interface directly with the customizer.</p>
                <h3 class="patchnotes">The JSON area is tiny!</h3>
                <p class="patchnotes">You can scale the JSON textarea by dragging on the bottom right. This is actually true of HTML textareas in general.</p>
                <h3 class="patchnotes">.SOLAR? What even IS that?</h3>
                <p class="patchnotes">It's literally just a JSON file, labeled SOLAR in order to mark that it's a solar system for Periapsis.</p>
                <h3 class="patchnotes">Will we be able to migrate systems from WSSG?</h3>
                <p class="patchnotes">Probably not. It's not on the roadmap currently, at least.</p>
                <h3 class="patchnotes">What's an AUâ˜‰?</h3>
                <p class="patchnotes">A measurement of received stellar energy that scales proportionally to the distance from the star. In short, it's how far Earth would need to be from the star to receive the same amount of energy it does from the Sun IRL.</p>
                <h3 class="patchnotes">What's a seed?</h3>
        <p class="patchnotes">A seed is the base number the app uses to generate a system. The same seed always gives the same generated system, assuming the chance for life and whether to skip non-habitable systems are set the same.
            For example, the seed 69420 on v0.4021, if "force habitable planet" is set and the value 0.69 is used for the chance of life appearing on a habitable planet, yields a system with a civ homeworld.
        </p>
        <h3 class="patchnotes">Why aren't there any planets with oxygen?</h3>
        <p class="patchnotes">The atmosphere composition entry only lists the gas that makes up the majority of the atmosphere. Oxygen can be inferred based on the presence of Phanerozoic life. However, I don't really see the significance of a planet's atmosphere having oxygen.</p>
            </div>
            <p></p>
        
            </div>
            <div class="main">
                <div class="patchnotes"></p>
                <button onClick="toggleJSONEditor();" class="genbutton">Open JSON editor</button>
                <div style="display:none;" id="jsoneditor">
                    <textarea type="text" class="genbutton3" placeholder="{
        'isStar': true,
        'isPlanet': false, ..." id="jsoninput"></textarea>
                    <div>
                        <button onClick="updateSystem();" class="genbutton" style="width:350px; display:inline">Update system</button>
                        <button onClick="saveTextAsFile(t.value,'system.solar');" class="genbutton" style="width:350px; display:inline">Download SOLAR file</button>
                        <input type="button" id="loadFile" class="genbutton" style="width:350px; display:inline; text-align:center; text-wrap:wrap;" value="Choose SOLAR file" onclick="document.getElementById('file').click();" />
                        <button onClick="loadSystem();" class="genbutton" style="width:350px; display:inline; text-align:center; text-wrap:wrap;">Load selected SOLAR file</button>
                        <input type="file" style="display:none;" id="file" name="file"/>
                    </div>
                    
                </div>
                <span id="pagenumber"></span>

                </div>
                <p></p>
                <div class="systemcontainer">
                    <div class="system">
                       
                    </div>

                </div>
            </div>
        
            <p></p>
    </main>
	<script>
        var consonants = [
    "m", "t", "c", "b", "k", "l", "r", "n", "v", "th", "f", "j", "p", "d", "g", "st", "m", "t", "c", "b", "k", "l", "n", "v", "th", "f", "j", "p", "d", "g", "st", "rh", "br", "tr", "", "pl", "s", "sh", "sc", "h", "ch", "ph", "gl", "fl", "cl", "bl", "sch", "", "", "", "", ""
]
var vowels = [
    "a", "e", "i", "o", "u",
]
var glides = [
    "r", "", ""
]
function syllable(){
    if(prng() >= 0.5){
        return consonants[dice(1,consonants.length)]+vowels[dice(1,vowels.length)]+glides[dice(1,glides.length)];
    }else{
        return namepenul[dice(1,namepenul.length)];
    }
    
    
}
var nameparts = [
    "mer", "tar", "mar", "cur", "mur", "cer", "ter", "bur", "ber", "bir", "cir", "ker", "cu", "la", "lar", "bar", "ba", "me", "ry", "re", "ro", "ra", "nu", "ve", "va", "var", "ra", "ce", "re", "sa", "tha", "fa", "tur", "ju", "pi", "da", "i", "o", "pa", "par", "ga", "ny", "cal", "li", "sto", "la", "ti", "ta", "te", "thy", "di", "rhe", "a", "pe", "tu", "ri", "bri", "ni", "be", "ro", "tri", "to", "u", "ra", "e", "ne", "p", "tu", "ne", "plu", "ri", "ma", "ke", "qua", "ar", "se", "na", "tasci", "ti", "sci", "fer", "n", "lar", "sta", "ste", "re", "plo", "cha", "ro", "bi", "mo", "ho", "du", "na", "mi", "mu", "ty", "lo", "bor",  
]
var namepenul = [
"mer", "tar", "mar", "cur", "mur", "cer", "ter", "bur", "ber", "bir", "cir", "ker", "cu", "la", "lar", "bar", "ba", "me", "ry", "re", "ro", "ra", "nu", "ve", "va", "var", "ra", "ce", "re", "sa", "tha", "fa", "tur", "ju", "pi", "da", "i", "o", "pa", "par", "ga", "ny", "cal", "li", "sto", "la", "ti", "ta", "te", "thy", "di", "rhe", "a", "pe", "tu", "ri", "bri", "ni", "be", "ro", "tri", "to", "u", "ra", "e", "ne", "tu", "ne", "plu", "ri", "ma", "ke", "qua", "ar", "se", "na", "tasci", "ti", "sci", "fer", "lar", "sta", "ste", "re", "plo", "cha", "ro", "bi", "mo", "ho", "du", "na", "mi", "mu", "ty", "lo", "bor", 
]
var nameends = [
    "s", "", "", "n", "t"
]

function toTitleCase(str) {
  return str.replace(
    /\w\S*/g,
    text => text.charAt(0).toUpperCase() + text.substring(1).toLowerCase()
  );
}

function generatePlanetName() {
    var tmp3;
    if(prng()>=0.5){
        if(prng()>=0.5){
            if(prng()>=0.3){
                tmp3 = (syllable()+syllable()+nameends[dice(1,nameends.length)]);
    } else {
        tmp3 = (syllable()+syllable()+syllable()+syllable()+nameends[dice(1,nameends.length)]);
    }
            
    } else {
        tmp3 = (syllable()+syllable()+syllable()+nameends[dice(1,nameends.length)]);
    }
    } else {
        tmp3 = (syllable()+syllable()+nameends[dice(1,nameends.length)]);
    }
    return tmp3;
}

var imgsrcs =[
    "img/ATM_carbo.png",
    "img/staricons/typea.png",
    "img/staricons/typeb.png",
    "img/staricons/typef.png",
    "img/staricons/typeg.png",
    "img/staricons/typek.png",
    "img/staricons/typem.png",
    "img/ATM_nitro.png",
    "img/bgstars.png",
    "img/planeticons/ammoniaOverlay1.png",
    "img/planeticons/ammoniaOverlay2.png",
    "img/planeticons/ammoniaOverlay3.png",
    "img/planeticons/carbonaceousPlanet.png",
    "img/planeticons/carbonaceousPlanet2.png",
    "img/planeticons/carbonaceousPlanet3.png",
    "img/planeticons/carbonaceousPlanet4.png",
    "img/planeticons/carbonaceousPlanet5.png",
    "img/planeticons/carbonaceousPlanet6.png",
    "img/planeticons/gasGiant.png",
    "img/planeticons/gasGiant2.png",
    "img/planeticons/gasGiant3.png",
    "img/planeticons/gasGiant4.png",
    "img/planeticons/gasGiant5.png",
    "img/planeticons/gasGiant6.png",
    "img/planeticons/geoActiveOverlay2.png",
    "img/planeticons/geoInactiveOverlay.png",
    "img/planeticons/iceGiant.png",
    "img/planeticons/iceGiant2.png",
    "img/planeticons/iceGiant3.png",
    "img/planeticons/iceGiant4.png",
    "img/planeticons/iceGiant5.png",
    "img/planeticons/iceGiant6.png",
    "img/planeticons/icyPlanet.png",
    "img/planeticons/icyPlanet2.png",
    "img/planeticons/icyPlanet3.png",
    "img/planeticons/icyPlanet4.png",
    "img/planeticons/icyPlanet5.png",
    "img/planeticons/icyPlanet6.png",
    "img/planeticons/lifeIndicator.png",
    "img/planeticons/lifeOverlayAmmonia.png",
    "img/planeticons/lifeOverlayMethanum.png",
    "img/planeticons/lifeOverlayWater.png",
    "img/planeticons/metallicPlanet.png",
    "img/planeticons/metallicPlanet2.png",
    "img/planeticons/metallicPlanet3.png",
    "img/planeticons/metallicPlanet4.png",
    "img/planeticons/metallicPlanet5.png",
    "img/planeticons/metallicPlanet6.png",
    "img/planeticons/methaneOverlay1.png",
    "img/planeticons/methaneOverlay2.png",
    "img/planeticons/methaneOverlay3.png",
    "img/planeticons/nitrogenOverlay1.png",
    "img/planeticons/nitrogenOverlay2.png",
    "img/planeticons/nitrogenOverlay3.png",
    "img/planeticons/rockyPlanet.png",
    "img/planeticons/rockyPlanet2.png",
    "img/planeticons/rockyPlanet3.png",
    "img/planeticons/rockyPlanet4.png",
    "img/planeticons/rockyPlanet5.png",
    "img/planeticons/rockyPlanet6.png",
    "img/planeticons/shade.png",
    "img/planeticons/shade2.png",
    "img/planeticons/torridPlanetOverlay.png",
    "img/planeticons/waterOverlay1.png",
    "img/planeticons/waterOverlay2.png",
    "img/planeticons/waterOverlay3.png",
]
var imageobjs = {

}
function Initialize(){

document.documentElement.setAttribute('data-theme', 'dark');
var promises2 = [];
for(let ak = 0; ak < imgsrcs.length; ak++){
    promises2.push(add_image_to_list2(imageobjs,imgsrcs[ak]));
}


Promise.allSettled(promises2).then(console.log("All images loaded!"));
}

var densities = {};
densities.metal = 8;
densities.rock = 2.7;
densities.ice = 1;
densities.gas = 1;

class Planet{
    constructor(star,parentbody,distance=1,distanceFromParent=1,index=1,mass=1,moons=[],AUSun=1,metal=0.5,rock=0.5,ice=0,gas=0){
        this.isPlanet=true;
        this.isStar=false;
        this.name="Salibe";
        this.star=star;
        this.parentbody=parentbody;
        this.distanceFromParent=distanceFromParent;
        this.index=index;
        this.mass=mass;
        this.AUSun=AUSun;
        this.metal=metal;
        this.rock=rock;
        this.ice=ice;
        this.gas=gas;
        this.magneticField=false;
        this.atmothickness=0;
        this.atmobasegas="none";
        this.greenhouseEffect=1;
        this.liquid=-1;
        this.geoactive=false;
        this.life=0;
        this.lifeLocation="subglacial";
        this.civ=false;
        
        this.liquidCoverage = 0;
        this.density = function(){
            return (
    densities.metal*this.metal + 
    densities.rock*this.rock + 
    densities.ice*this.ice +
    densities.gas*this.gas)
        }
        this.radius = function(){
            return Math.cbrt(this.mass/(this.density()/5.5))*6371
        }
        this.baseTemperature = function(){
            return 255/sqrt(AUSun)
        }
        this.moons=moons;
    }
}
class Star{
    constructor(planets=[],luma=1,temp=5778,age=4603,trueLuma=1,WD=false,isPrimary=true,parentbody,AUSun,distanceFromParent){
        this.isStar=true;
        this.isPlanet=false;
        this.luma=luma;
        this.temp=temp;
        this.age=age;
        this.mass = function() {
            return lumaToMass(this.luma);
        }
        this.radius = function(){
            return this.mass() * 696000;
        }
        this.trueLuma=trueLuma;
        this.WD=WD;
        this.isPrimary=isPrimary;
        this.parentbody=parentbody;
        this.mainPlanet;
        this.AUSun=AUSun;
        this.planets=planets;
    }
}
var t = document.getElementById("jsoninput");
async function loadSystem(){
    const selectedFile = document.getElementById("file").files[0];
    const systext = await selectedFile.text();
    document.getElementById("jsoninput").value = systext;
}
function saveTextAsFile(textToWrite, fileNameToSaveAs)
    {
    	var textFileAsBlob = new Blob([textToWrite], {type:'text/plain'}); 
    	var downloadLink = document.createElement("a");
    	downloadLink.download = fileNameToSaveAs;
    	downloadLink.innerHTML = "Download File";
    	if (window.webkitURL != null)
    	{
    		// Chrome allows the link to be clicked
    		// without actually adding it to the DOM.
    		downloadLink.href = window.webkitURL.createObjectURL(textFileAsBlob);
    	}
    	else
    	{
    		// Firefox requires the link to be added to the DOM
    		// before it can be clicked.
    		downloadLink.href = window.URL.createObjectURL(textFileAsBlob);
    		downloadLink.onclick = destroyClickedElement;
    		downloadLink.style.display = "none";
    		document.body.appendChild(downloadLink);
    	}
    
    	downloadLink.click();
    }

function distance(object){
    if(object.star==undefined){
        
        return object.distanceFromParent;
    }

    if(object.star.planets[0] != undefined){
        if(object.star.planets[0].isStar && object.star.planets[0].AUSun <= 0.3){
            return object.AUSun * Math.sqrt(object.star.luma+object.star.planets[0].luma); //calculate distance to star from AUSun
    } else {
        return object.AUSun * Math.sqrt(object.star.luma); //calculate distance to star from AUSun
    }}
    
}

function distanceFromParent(planetOutput){
    if(planetOutput.isPlanet){
        if(planetOutput.parentbody.isStar && distance(planetOutput) != undefined){// correct distanceFromParent for major planets
        return distance(planetOutput); 
    } else {
        return planetOutput.distanceFromParent;
    }
    }
    return planetOutput.AUSun * Math.sqrt(planetOutput.parentbody.luma);
}

function radius(object){
    if (object.isStar){
        if(!object.WD){
            return mass(object)*696000;
        }else{
            return 6000;
        }
        
    } else {
        return Math.cbrt(object.mass/(density(object)/5.5))*6371
    }
}

function mass(star){
    return lumaToMass(star.luma);
}

function density(planet_in){
    return (
    densities.metal*planet_in.metal + 
    densities.rock*planet_in.rock + 
    densities.ice*planet_in.ice +
    densities.gas*planet_in.gas)
}

function baseTemperature(planet_in){
    if(planet_in.star.WD){
        if(planet_in.star.parentbody != undefined){
            if(distanceFromParent(planet_in.star)<1 && planet_in.star.parentbody.WD == false){
                return 255/sqrt(planet_in.AUSun)
            }
            
            
        } 
        
        if(planet_in.star.planets[0] == undefined){
            
            return 3;
        }
        if(planet_in.star.planets[0].isStar && distanceFromParent(planet_in.star.planets[0]) <= 1 ){
            if(distanceFromParent(planet_in.star.planets[0])<1 && planet_in.star.planets[0].WD == false){
                return 255/sqrt(planet_in.AUSun)
            }
        }

        return 3;
    }else{
        return 255/sqrt(planet_in.AUSun)
    }
   
}

var seed = Math.floor(Math.random()*441041798642919);
function prng() {
    seed = ((seed*seed*seed*seed*seed*seed)+249254546412641)%491041798642919;
    //return seed/491041798642919;
    return seed/491041798642919;
    
}

function massToLuma(mass_in){ // convert mass to luma for a...
    if (mass_in <= 0.42){ // low-mass star
        return 0.23*(mass_in**2.3); 
    }
    if (mass_in > 0.42 && mass_in <= 1.96){ // medium-mass star
        return (mass_in**4);
    }
    if (mass_in > 1.96){ // high-mass star
        return 1.4*(mass_in**3.5);
    }
}
function lumaToMass(luma_in){ // convert luma to mass for a...
    if (luma_in <= 0.23*(0.42**2.3)){ // low-mass star
        return (luma_in/0.23)**(1/2.3);
    }
    if (luma_in > 0.23*(0.42**2.3) && luma_in <= (1.96**4) ){ // medium-mass star 
        return (luma_in)**(1/4);
    }
    if (luma_in > (1.96**4) ){ // high-mass star
        return (luma_in/1.4)**(1/3.5);
    }
}
function checkForTerrestrialPlanet(system){
    for(let ii in system.planets){
        if(system.planets[ii].liquid == 0){
            return true;
        }
    }
    return false;
}
var jk = 0;
function Test(){
    
    var oolala=document.getElementById("seedinput");
    if((oolala.value >= 0 || oolala.value <= 0)&&oolala.value != ""){ // oolala.value is a number
    seed=oolala.value;
    } // else use random seed
    var kseed = seed;
    
    var ij = 0;
    var div = document.createElement("div");
    div.classList.add("system");
    if(document.getElementById("forceTerrestrialPlanet").checked){
        var kseed = seed;
        var test_star = generateStar(0.08,8,true);
        var planets = sortByDistance(test_star.planets);
        while(checkForTerrestrialPlanet(test_star)==false && ij <= 50){
            ij++;
            var kseed = seed;
            var test_star = generateStar(0.08,8,true);
            var planets = sortByDistance(test_star.planets);
        }
        if(checkForTerrestrialPlanet(test_star)==false){
            var div2 = document.getElementsByClassName("systemcontainer")[0];
    div2.innerHTML = " "
    addline("Could not generate valid system! Try again",div,"p",false);
    console.log("Could not generate system with terrestrial planet, skipped 50 systems")
    div2.appendChild(div);
    return;
        }
    }else{
    var test_star = generateStar(0.08,8,true);
    var planets = sortByDistance(test_star.planets);
    }
    console.log("System generated with seed "+kseed+", skipped "+ij+" systems")
    
    var div2 = document.getElementsByClassName("systemcontainer")[0];
    div2.innerHTML = " "
    div2.appendChild(drawSystem(div,test_star,false));
    systemDataToHTML(test_star,div);
    div2.appendChild(div);
    document.getElementById("jsoninput").value = (JSON.stringify(JSON.decycle(test_star, undefined),null, "\t"));
}

function FFS(a,b){
    return 180*(a**60) +  100*(a**10) + 37*a + 3.2 - 40*b;
}
function OMFG(a,b){
    return 60*(180*(a**59)) + 10*(100*(a**9)) + 37;
}
function SomehowFindTheInverseOfThisDegree60Polynomial(in_1){
var inter_x=0.5;
var inter_temp;
while (Math.abs(FFS(inter_x,in_1))>0.000000001){
inter_temp = inter_x;
inter_x -= FFS(inter_temp,in_1)/OMFG(inter_temp,in_1);
}
return inter_x;
}
function planetTemp(planet){
    if(planet.greenhouseEffect != undefined){
        return baseTemperature(planet)*planet.greenhouseEffect;
    } else {
        return baseTemperature(planet);
    }

}
function lowTemp(planet){
    if(planet.greenhouseEffect != undefined){
        return planetTemp(planet)* (1-(0.276 * (1/((6*planet.greenhouseEffect - 5)**2))));

    } else {
        return planetTemp(planet)* (1-(0.276 * (1/((6 - 5)**2))));
    }    
}
function highTemp(planet){
    if(planet.greenhouseEffect != undefined){
        return planetTemp(planet)/ (1-(0.155 * (1/((6*planet.greenhouseEffect - 5)**2))));

    } else {
        return planetTemp(planet)/ (1-(0.155 * (1/((6- 5)**2))));
    }    
}
class Liquid {
    constructor(melting,boiling,deltaH){
        this.melting=melting;
        this.boiling=boiling;
        this.deltaH=deltaH;
    }
}
var water = new Liquid(273,373,40660);
var methanum = new Liquid(90,111,8170);
var liquids = [water, methanum]

function boilingPoint(pressure = 1, liquid = water){
    let baseBoilingPoint = liquid.boiling;
    let deltaH = liquid.deltaH;
    let xg = deltaH*baseBoilingPoint;
    let yg = 8.314*baseBoilingPoint*Math.log(1/pressure);
    let zg = xg/(yg+deltaH);
    return zg;
}
var ccc = 0;
var ddd = 0;
function atmosphere(planet){
    planet.atmobasegas="none";
    planet.liquid="none";
    planet.atmothickness=0;
    planet.magneticField=false;
    planet.greenhouseEffect=1;
    planet.oxygen=0;
    planet.liquidCoverage=0;
    planet.liquid=-1;
    if(planet.metal*planet.mass>planet.star.age/(100000)){
        if(prng()<=planet.mass*4){
            planet.magneticField = true;
        }

    }else{
        planet.magneticField = false;
    }
    if(baseTemperature(planet) < 50) { // if the planet is too cold, none of these gases can form an atmosphere
        return;
    } 
    if(prng()<=planet.mass){
        if(planet.magneticField || (planet.parentbody.magneticField && AUToKm(distanceFromParent(planet)) <= radius(planet.parentbody)*8) || planet.AUSun >= 3){
            planet.atmobasegas = "nitrogen"; // assume the atmosphere is nitrogen (as is the case with Pluto, Earth, and Titan);
            planet.atmothickness = (prng()**4)*min(planet.mass,3)*16; // distribution of atmospheres
            planet.greenhouseEffect = (prng()*0.25)*Math.min(1,planet.atmothickness)+0.05*Math.min(8,planet.atmothickness)+1
   
            if(highTemp(planet)>=boilingPoint(planet.atmothickness,water) && baseTemperature(planet)<=boilingPoint(planet.atmothickness,water) && planet.AUSun<1){
                planet.atmobasegas = "carbondioxide"; // runaway greenhouse
                
                planet.atmothickness = prng()*50+75;
                planet.greenhouseEffect = prng()*2+2;
            }
        }   else {
            planet.atmobasegas = "carbondioxide"; // Mars-like atmosphere
            planet.atmothickness = (prng()*0.04);
        }
    if(planet.atmothickness <= 0.02){ // very small atmosphere
            if(planet.atmothickness <= 0.00001){
                planet.atmothickness = 0;
                planet.atmobasegas = "none";
                planet.greenhouseEffect = 1;
            }
            return;
        } else;
    }
    for (let i in liquids){
        if(highTemp(planet)>=liquids[i].melting && highTemp(planet)<=boilingPoint(planet.atmothickness,liquids[i])){
            if(prng()>=0.2){
                if(lowTemp(planet)>=liquids[i].melting){
                    planet.liquidCoverage = Math.min((prng()*2)**5+0.01,1);
                    planet.liquid = i;
                } else {
                    planet.liquidCoverage = Math.min((prng()*2)**5+0.01,1);
                    planet.liquid = i;
                }
                

            }
        }
    }
    planet.geoactive = false;
    if(planet.parentbody != undefined){
        if (planet.parentbody.isPlanet && planet.parentbody.mass >= 12 && planet.mass >= (planet.star.age/1000)*prng()/1000+0.0002 && AUToKm(distanceFromParent(planet)) <= radius(planet.parentbody)*15){
            planet.geoactive = true;
        } else {
            if(planet.mass >= 0.03*(prng()*planet.star.age/10000) || planet.moons.length > 0){
                planet.geoactive = true;
            }
        }
    }
    if(planet.geoactive && planet.liquid == 0 && planet.liquidCoverage >= 0 && prng()<=document.getElementById("lifeChance").value){

        if(prng()/2 <= (planet.star.age-3000)/10000){
            planet.life = 2;
        }else{
            planet.life = 1;
        }
        planet.lifeLocation = "surface";
    }
    if(planet.geoactive && planet.ice > 0 && prng()<=document.getElementById("lifeChance").value){

        if(prng()/2 <= (planet.star.age-3000)/100000){
            planet.life = 2;
        }else{
            planet.life = 1;
        }
        planet.lifeLocation = "subglacial"
    }
    if(planet.lifeLocation == "surface"){

        if(prng()<=((planet.star.age-3000)/7000)**10+0.001){
            planet.civ = true;
            
        }
        else {
            
        }
    }




}

function starTemp(star){
    var x = lumaToMass(star.luma);
    var gx = 1000 * (-2.27852 -
    0.0125926 * (
        1169.13 * Math.sqrt(
            (1107170000000 * x * x) +
            (2251560000000 * x) + 
            (11809900000000)
        ) -
        1230190000 * x -
        1250870000
    ) ** (1/3) + 30762 / (
        1169.13 * Math.sqrt(
            (1107170000000 * x * x) +
            (2251560000000 * x) + 
            (11809900000000)
        ) -
        1230190000 * x -
        1250870000
    ) ** (1/3));
    return(gx);
}

function StarTemperatureFromMass(x){
var gx = 1000 * (-2.27852 -
    0.0125926 * (
        1169.13 * Math.sqrt(
            (1107170000000 * x * x) +
            (2251560000000 * x) + 
            (11809900000000)
        ) -
        1230190000 * x -
        1250870000
    ) ** (1/3) + 30762 / (
        1169.13 * Math.sqrt(
            (1107170000000 * x * x) +
            (2251560000000 * x) + 
            (11809900000000)
        ) -
        1230190000 * x -
        1250870000
    ) ** (1/3));
    return(gx);

}

function MassFromStarTemperature(x){
 return (2.02/9)*x-0.45+((x-5)/17)**3+(x/15)**2;
}

function generateStar(massLower=0.08,massUpper=8,isPrimary=true,canGeneratePlanets=true,parentbody){ // generate a star
    console.log(massToLuma(8));
    var jLi = SomehowFindTheInverseOfThisDegree60Polynomial(massLower);
    var kLi = SomehowFindTheInverseOfThisDegree60Polynomial(massUpper);
    var Li = prng()*(kLi-jLi)+jLi; // mass input, assuming main sequence for now (giant stars will not be simulated)
    var Li2 = (0.37/0.4)*Li+0.08+(Li**10)*2.5+(Li**60)*4.5; // mass
    var starOutput = new Star(
    [], // no planets for now
    massToLuma( // get luma from mass
        Li2
    ),
    StarTemperatureFromMass(Li2), // formula for star temperature that's probably wrong but whatevs
    prng()*10000+200, // age of the star
    massToLuma(Li2), false, // assuming the star is not a remnant for now, this will be checked later
    isPrimary
    );
    if(isPrimary==false){
        starOutput.parentbody = parentbody;
        starOutput.age = parentbody.age;
    }
    starOutput.name = toTitleCase(generatePlanetName());
    // check if star should be a remnant
    var Li3 = 12000 /* lifespan of Sun */ * Li2**-2.5
    if (starOutput.age > Li3){

        starOutput.trueLuma = 0; // white dwarves have effectively no luminosity
        starOutput.WD = true; // the star is a white dwarf
    }
    if(isPrimary==true){
        if(prng()>=0.75){
        var ghi = generateStar(0.08,lumaToMass(starOutput.luma),false,false,starOutput)
        starOutput.planets.push(
            ghi
        )
        ghi.AUSun=(prng()*0.1)+0.1

    }
    if(prng()>=0.75){
        var ghi = generateStar(0.08,lumaToMass(starOutput.luma),false,true,starOutput)
        starOutput.planets.push(
            ghi
        )
        ghi.AUSun=(prng()*75)+75
        

    }
    }

    
    if(canGeneratePlanets==true){
        if(lumaToMass(starOutput.luma)<(prng()/5)+0.08){
        placePlanetsResonant(starOutput);
    }else{
        placePlanetsNonResonant(starOutput);
    }
    }

    return starOutput; // return the generated star    
}
function min(x,y){
    return Math.min(x,y);
}
function generatePlanet(massLower=0.0001,massUpper=1000,AUSun,parentbody,star,distanceFromParent,index,type,isMoon=false){ // generate a planet given the specified properties; distance is in AU:sun: for convenience
    // type 0 = rocky planet (can have surface ice if beyond 2.5 AU:sun:)
    // type 1 = gas giant
    // type 2 = ice giant
    var planetOutput = new Planet(
        star, // the star that the planet most directly orbits around (NOT the main star of the system)
        parentbody, // the object that the planet orbits, i.e. gas giant, star, etc
        null, // figure out distance later
        distanceFromParent,
        index, // this will be the order in which planets are generated: large planets first, followed by medium planets, then small planets, and finally unterplanets
        1, // mass is generated later on
        [], // no moons by default
        AUSun // AUSun value
    )
    planetOutput.name = toTitleCase(generatePlanetName());
    if(!(planetOutput.parentbody.isStar)){// correct AUSun for moons 
        planetOutput.AUSun = planetOutput.parentbody.AUSun; 
    }
    if(planetOutput.star.planets[0] != undefined){
        if(planetOutput.star.planets[0].isStar && planetOutput.star.planets[0].AUSun <= 0.3){
        planetOutput.distance = planetOutput.AUSun * Math.sqrt(planetOutput.star.luma+planetOutput.star.planets[0].luma); //calculate distance to star from AUSun
    } else {
        planetOutput.distance = planetOutput.AUSun * Math.sqrt(planetOutput.star.luma); //calculate distance to star from AUSun
    }
    } else { // this is first planet
        planetOutput.distance = planetOutput.AUSun * Math.sqrt(planetOutput.star.luma);
    }


    if(planetOutput.parentbody.isStar){// correct distanceFromParent for major planets
        planetOutput.distanceFromParent = planetOutput.distance; 
    }
    planetOutput.mass = (
        10**(prng()*(Math.log10(massUpper)-Math.log10(massLower))+Math.log10(massLower)) // random planet mass
    )
    planetOutput.metal = 0;
    planetOutput.ice = 0;
    planetOutput.gas = 0;
    planetOutput.rock = 0;
    if(type==2){ // ice giant?
            planetOutput.ice = (prng()/3)+0.5; // planet is mostly ice...
            planetOutput.gas = 1-planetOutput.ice; // and some gas
            planetOutput.ice *= (prng()/6)+0.65; // make room for rock
            planetOutput.gas *= (prng()/6)+0.65; 
            planetOutput.rock = (1-planetOutput.ice)-planetOutput.gas // add rocky core
    } else if(type==1) { // gas giant?
            planetOutput.gas = (prng()/6)+0.8; // gaseous envelope
            planetOutput.rock = 1-planetOutput.gas; // and rocky core
    } else if(type==0) { // rocky planet?
            planetOutput.metal = prng()*(5/6); // metallic core
            planetOutput.rock = 1-planetOutput.metal; // remaining silicate
            var iceProportion = (prng()*0.5)+0.01
            if(prng()<=(AUSun-2.5)/4) // ice planets are more likely the further out you are 
            {
                planetOutput.metal *= 1-iceProportion; // make room for ice
                planetOutput.rock *= 1-iceProportion;
                planetOutput.ice = iceProportion; // add ice crust/mantle
            }
            atmosphere(planetOutput);
    }
    
    

    if(isMoon==false){
 
        if(type==0||prng()>0.5){

            if(prng()<=planetOutput.mass-0.5){
                var k2 = prng()*Math.cbrt(planetOutput.mass)
                for (let o = 0; o < k2; o++){

                    moon(planetOutput);
                }
            }

        } else {
         
        var m = (kmToAU(prng()+1*(radius(planetOutput)*3)))
        
        for (var k = 0; k < dice(1,5)+2; k++) {
            moon(planetOutput,m)
            var n = dice(1,3)+1
            m *= YearToOrbit((n+1)/n)
        }
    
        }
    }
    
    return planetOutput;
}


function FirstPlanet(star){
    
    if(lumaToMass(star.luma) <= 0.5){ // case 1: star is not large enough (<0.2 mass) to form a large planet; skip this step {depends on star}

    }else{ // case 2: star is large enough to form a large planet (>150 Earth masses), but no such planet forms {33%}
        
        if(prng()<=(Math.min(lumaToMass(star.luma),1)-0.33)){  // case 3: star is large enough to form a large planet (>150 Earth masses), planet forms: {67%}
            if(prng()>=0.50){ // case 3c: no migration: {50%}
                star.innerSystem = 0; // - inner system flag is set to 0, indicating no migration, and no orbital zones are marked invalid
                var kp = generatePlanet(
                        150,
                        1000,
                        (prng()*3)+4,
                        star,
                        star,
                        null,
                        star.planets.length,
                        1
                    )
                    if(!((kp.star.WD && kp.AUSun<1)||hillSphere(kp.star)<distance(kp))){
                        star.planets.push(kp); // - large planet is placed between 4 and 7 AUSun
                        star.mainPlanet = star.planets.length-1;
                    }

                    
                    
            } else if(prng()>=0.50){   // case 3b: "hot jupiter": {25%}
                if(prng()<=star.age/8000){ // hot jupiter is destroyed, 
                    star.innerSystem = 3;   // inner system flags 1 and 3 have the same behavior, but 3 indicates that the planet with index 0 is not the main planet (as no main planet exists)
                } else {         // hot jupiter is generated    
                    star.innerSystem = 1; // - inner system flag is set to 1, indicating a hot jupiter, and meaning zones inwards of 5 AUSun are marked invalid for medium/large planets (>2 Earth masses), zones inwards of 3 AUSun are marked invalid for small planets, and zones inwards of 2 AUSun are marked invalid for unterplanets
                    var kp = generatePlanet(
                        150,
                        1000,
                        (prng())+0.1,
                        star,
                        star,
                        null,
                        star.planets.length,
                        1
                    )
                    if(!((kp.star.WD && kp.AUSun<1)||hillSphere(kp.star)<distance(kp))){
                        star.planets.push(kp); // - large planet is placed between 0.1 and 0.4 AUSun
                        star.mainPlanet = star.planets.length-1;
                    }
                }
            } else { // case 3a: "grand tack": {25%}
            
                star.innerSystem = 2;  // - inner system flag is set to 2, indicating a grand tack, and meaning zones inwards of 6 AUSun are marked invalid for medium/large planets (>2 Earth masses), and zones between 2 and 6 AUSun are marked invalid for small planets, but not unterplanets
                var kp = generatePlanet(
                    150,
                        1000,
                        (prng()*3)+4,
                        star,
                        star,
                        null,
                        star.planets.length,
                        1
                    );
                    if(!((kp.star.WD && kp.AUSun<1)||hillSphere(kp.star)<distance(kp))){
                        
                        star.planets.push(kp); // - large planet is placed between 4 and 7 AUSun
                        star.mainPlanet = star.planets.length-1;
                    }
                    
                star.planets.push(  // - another large (but smaller) planet is placed between 4 and 8 AU (actual distance) out from the main large planet
                    generatePlanet(
                        75,
                        star.planets[star.mainPlanet].mass,
                        star.planets[star.mainPlanet].AUSun+((prng()*4)+4) / Math.sqrt(star.luma),
                        star,
                        star,
                        null,
                        star.planets.length,
                        1
                    ))
                }
            }
        }
    }
    function sqrt(input){
        return Math.sqrt(input);
    }
    function determinePlanetPlacement(star,size,inner=0.3,outer=50){ // size 0 is gas giant, size 1 is medium/large, size 2 is small, size 3 is unterplanet; returns in AUSun
        var orbitdist = 10**(prng()*(Math.log10(outer)-Math.log10(inner))+Math.log10(inner)); // try a random orbit distance
        var planets = star.planets; // for convenience
        var orbitValid = 0; // by default
            var jk = orbitdist; // just to make sure
            for(var j = 0; j < planets.length; j++){ // go through each planet
                if(planets[j].isPlanet){
                    var mass = planets[j].mass;
                }else{
                    var mass = lumaToMass(planets[j].luma)*333000
                }
                var closeness = Math.abs(orbitdist*sqrt(sqrt(star.luma)) - planets[j].AUSun*sqrt(sqrt(star.luma)));
                if(closeness < 0.15*sqrt(planets[j].mass)){ // is it a small planet quite close to a gas giant?
                    return;
                }
                if((closeness < 0.3*sqrt(planets[j].mass)|| orbitdist <= 3) && size == 0){ // is it a large planet moderately close to a gas giant?
                    return;
                }
                if(
                    (star.innerSystem==1 && orbitdist <= 5 && size <= 1)|| // would it have been wiped by a hot jupiter migration?
                    (star.innerSystem==1 && orbitdist <= 3 && size == 2)||
                    (star.innerSystem==1 && orbitdist <= 2 && size == 3)
                ){
                    return;
                }
                if(
                    (star.innerSystem==2 && orbitdist <= 6 && size  <= 1)|| // would it have been wiped by a grand tack migration?
                    (star.innerSystem==2 && orbitdist <= 6 && orbitdist >= 2 && size == 2)
                ){
                    return;
                }
                if(
                    (orbitdist <= inner)|| // kjust to make sure
                    (orbitdist >= outer)
                ){
                    return;
                } 
            }
            if(jk==orbitdist){
                orbitValid = 1;
                return orbitdist; 
            }
        
        return;
        
    }
    function sortByDistSub(left, right) {
  let sortedArr = [] // the sorted items will go here
  while (left.length && right.length) {
    // Insert the smallest item into sortedArr
    if (distanceFromParent(left[0]) < distanceFromParent(right[0])) {
       
      sortedArr.push(left.shift())
      
    } else {
      sortedArr.push(right.shift())
    }
  }
  // Use spread operators to create a new array, combining the three arrays
  return [...sortedArr, ...left, ...right]
}
    function sortByDistance(planets){
      
  // Base case
  if (planets.length <= 1) return planets
  let mid = Math.floor(planets.length / 2)
  // Recursive calls
  let left = sortByDistance(planets.slice(0, mid))
  let right = sortByDistance(planets.slice(mid))
  return sortByDistSub(left,right);

    }

    function determineMoonPlacement(planet){ // returns in AU
        var outer = Math.min(hillSphere(planet)/2,radius(planet)*100);
        var inner = kmToAU(sqrt(radius(planet)/6371)*63710)
        if(outer/10<inner){
            return;
        }
        var orbitdist = (prng()*(Math.sqrt(outer)-Math.sqrt(inner))+Math.sqrt(inner))**2;
        var planets = planet.moons;
        var orbitValid = 0;
            var jk = orbitdist;
            for(var j = 0; j < planets.length; j++){

                var closeness = Math.abs(orbitdist - distanceFromParent(planets[j]));
                if(closeness < 0.15*sqrt(planets[j].mass)){
                    return;
                }
                if(
                    (orbitdist <= inner)||
                    (orbitdist >= outer)
                ){
                    return;

                }
            }
            if(jk==orbitdist){
                orbitValid = 1;
                return orbitdist;
            }
        
        return;
        
    }
    function gasGiant(star){
        AUSun = determinePlanetPlacement(star,0,3,Math.min(50*sqrt(lumaToMass(star.luma)),66));
        if(AUSun != undefined){
            if(star.mainPlanet != undefined){
                var kp=generatePlanet(75,star.planets[star.mainPlanet].mass,AUSun,star,star,null,star.planets.length,1);
                if(!(((kp.star.WD && kp.AUSun<1)||hillSphere(kp.star)<distance(kp)))){
                        star.planets.push(kp);
                    };
            } else {
                var kp=generatePlanet(75,150,AUSun,star,star,null,star.planets.length,1);
                if(!(((kp.star.WD && kp.AUSun<1)||hillSphere(kp.star)<distance(kp)))){
                        star.planets.push(kp);
                    };
            }
        }
    }
    function iceGiant(star){
        AUSun = determinePlanetPlacement(star,0,9,Math.min(50*sqrt(lumaToMass(star.luma)),66));
        if(AUSun != undefined){
            var kp=(generatePlanet(5,50,AUSun,star,star,null,star.planets.length,2));
            if(!(((kp.star.WD && kp.AUSun<1)||hillSphere(kp.star)<distance(kp)))){
                        star.planets.push(kp);
                    };
        }
    }
    function mediumPlanet(star){
        AUSun = determinePlanetPlacement(star,1,0.3,Math.min(50*sqrt(lumaToMass(star.luma)),66));
        if(AUSun != undefined){
            var kp=(generatePlanet(2,12,AUSun,star,star,null,star.planets.length,0));
            if(!(((kp.star.WD && kp.AUSun<1)||hillSphere(kp.star)<distance(kp)))){
                        star.planets.push(kp);
                    };
        }
    }
    function smallPlanet(star, AUSun = undefined){
        if(AUSun == undefined){
            AUSun = determinePlanetPlacement(star,2,0.3,Math.min(50*sqrt(lumaToMass(star.luma)),66));
        }
        
        if(AUSun != undefined){
            var kp=(generatePlanet(0.04,3,AUSun,star,star,null,star.planets.length,0));
            if(!(((kp.star.WD && kp.AUSun<1)||hillSphere(kp.star)<distance(kp)))){
                        star.planets.push(kp);
                    };
        }
    }
    function resonantPlanet(star, AUSun = undefined){
        if(AUSun == undefined){
            AUSun = determinePlanetPlacement(star,2,0.3,Math.min(50*sqrt(lumaToMass(star.luma)),66));
        }
        
        if(AUSun != undefined){
                var kp=(generatePlanet(0.2,2,AUSun,star,star,null,star.planets.length,0));
                if(!(((kp.star.WD && kp.AUSun<1)||hillSphere(kp.star)<distance(kp)))){
                        star.planets.push(kp);
                    };
        }
    }
    function unterplanet(star, c1, AUSun = undefined){
        if(AUSun == undefined){
        AUSun = determinePlanetPlacement(star,3,c1*0.8,c1*1.2);
        }
        if(AUSun != undefined){
            var kp=(generatePlanet(0.00005,0.005,AUSun,star,star,null,star.planets.length,0));
            if(!(((kp.star.WD && kp.AUSun<1)||hillSphere(kp.star)<distance(kp)))){
                        star.planets.push(kp);
                    };
        }
    }
    function moon(planet,AU){
        if(AU == undefined){
        AU = determineMoonPlacement(planet);
        }
        if(AU != undefined){
                planet.moons.push(generatePlanet(0.00005,Math.min(planet.mass/10,sqrt(planet.mass)/50),planet.AUSun,planet,planet.star,AU,planet.moons.length,0,true));
        }
    }
    function placePlanetsNonResonant(star){
        
        FirstPlanet(star);
        if(lumaToMass(star.luma)>0.2){
            for (var i = 0; i < (2)-(1+prng()); i++){
            gasGiant(star);
            }
            
        for (var i = 0; i < (4)-(1+prng()*2); i++){
            iceGiant(star);
        }
        }
        var c1=0;
        if(star.planets.length > 0 && sortByDistance(star.planets)[star.planets.length-1].isPlanet){
            c1=sortByDistance(star.planets)[star.planets.length-1].AUSun * YearToOrbit(3/2);
        }

        for (var i = 0; i < (2)-(prng()*1); i++){
            mediumPlanet(star);
        }
        for (var i = 0; i < (6)-(prng()*5); i++){
            smallPlanet(star);
        }
        for (var i = 0; i < (12)-(prng()*11); i++){
               if(c1>0){
                unterplanet(star,c1);
               }
}
        if(prng()>0.5/lumaToMass(star.luma)){
            for(var y = 0; y < (2)-(prng()*1); y++){
            c1=determinePlanetPlacement(star,1,2,75)
            for (var i = 0; i < (12)-(prng()*11); i++){
           
            unterplanet(star,c1);
        }
        }

        }
    
    }



    function OrbitToYear(orbit,mass=1){ // converts a ratio between orbital periods to a ratio between year lengths)
        return sqrt((orbit**3)/mass)
    }

    function dice(n, s) {
    var tot=0; 
    for(var i=0; i < n; i++) {
        tot += Math.floor(prng() * s);
    } 
    return tot;
}
    function YearToOrbit(year){
        return Math.cbrt(year**2)
    }
    function hillSphere(planet){
        if(planet.isPlanet){
            return (
                distanceFromParent(planet) *
            
            Math.cbrt(
                planet.mass /
                (3*(lumaToMass(planet.star.luma)*333000)+planet.mass)
            )
            )
        }else{
            if(planet.parentbody != undefined){
                return (
            distanceFromParent(planet) *
            
            Math.cbrt(
                lumaToMass(planet.luma)*333000 /
                (3*(lumaToMass(planet.parentbody.luma)*333000)+lumaToMass(planet.luma)*333000)
            )
            )
            } else {
                return 9999999999999999;
            }

        }

    }
    function kmToAU(km){
        return km/149600000
    }
    function AUToKm(au){
        return au*149600000
    }
    function placePlanetsResonant(star){
        var m = (prng())+0.4
        
        for (var k = 0; k < dice(1,5)+3; k++) {
            if(m<50){
                resonantPlanet(star,m)
            }
            var n = dice(1,3)+1
            m *= YearToOrbit((n+1)/n)
        }
    }
    
    /* DRAW SYSTEM */


    function drawSystem (div, star, sub = false){
        if(sub==false){
            canvases = document.createElement("div");
        }

        tempCanvas = document.createElement("canvas");
        tempCanvas.setAttribute("width","3700px");
        tempCanvas.setAttribute("height","800px");
        var canvascontainer = document.createElement("div");
    canvascontainer.appendChild(tempCanvas);
    canvascontainer.setAttribute("style","position:relative;width:100%;aspect-ratio:37/13;margin-bottom:0px;margin-top:0px;");
        jj = sortByDistance(star.planets);
        tempCanvas.classList.add("systemdisplay");
    var ctx = tempCanvas.getContext("2d");
    ctx.imageSmoothingQuality="high";
    ctx.fillStyle = "rgb(0,255,0)";
    ctx.fillStyle = "rgb(0,255,0)";
    drawPlanet(star,-50-(radius(star)**0.33)*1,3300,ctx,250); // DRAW STAR
        var g = 0;
        var gm = 1;
        for(var s = 0; s < star.planets.length; s++){
            if(jj[s].isPlanet){
                if(s>0){
                g += ((radius(jj[s])**0.33)*3)+((radius(jj[s-1])**0.33)*3)+((jj[s].AUSun**1)-(jj[s-1].AUSun**1))*50;
            }else{
                g += ((radius(jj[s])**0.33)*3)+((jj[s].AUSun**1))*50;
            }
            }  else {
                if (jj[s].planets.length == 0){
                    if(s>0){
                g += ((radius(jj[s])**0.33)*3)+((radius(jj[s-1])**0.33)*3)+((jj[s].AUSun**1)-(jj[s-1].AUSun**1))*50;
            }else{
                g += ((radius(jj[s])**0.33)*3)+((jj[s].AUSun**1))*50;
            }
                    
                    
                }
            }

        }
        var gt = g;
        if(gt<1700){
            gt = 1700;
        }
        g = 0;
        for(var s = 0; s < star.planets.length; s++){
            
            if(s>0){
                g += ((radius(jj[s])**0.33)*3)+((radius(jj[s-1])**0.33)*3)+((jj[s].AUSun**1)-(jj[s-1].AUSun**1))*50;
            }else{
                g += ((radius(jj[s])**0.33)*3)+((jj[s].AUSun**1))*50;
            }
            
            
            if(jj[s].isPlanet){
                if(jj[s].isStar){
                } else {
                    drawPlanet(jj[s],g,gt,ctx,250);
                    // DRAW PLANET
                    if(jj[s].moons.length > 0){
                        kk = sortByDistance(jj[s].moons);
                        var g2 = 250+((radius(jj[s])**0.33)*2);
                        for(var t = 0; t < jj[s].moons.length; t++){
                            g2 += (radius(kk[t])**0.33)*3
                            if(t>0){
                                g2 += (radius(kk[t-1])**0.33)*3+(distanceFromParent(kk[t])-distanceFromParent(kk[t-1]));
                            }else{
                                g2 += 0;
                            }
                            drawPlanet(kk[t],g,gt,ctx,g2);
                            // DRAW PLANET
                        }
                    }
                }
            } else {
                if (jj[s].planets.length == 0){
                    
                    drawCircle("rgb(255,255,0)",(g/gt)*3300+250,250,((radius(jj[s])**0.33)*1),ctx); // DRAW STAR
                    drawPlanet(jj[s],g,gt,ctx,250);
                    
                    
                } else {
                    var c3 = jj[s];
                    
                }
            }
        }
        
        if (sub) {
            return tempCanvas
        } else {

            
            canvases.appendChild(tempCanvas)
            if(c3 != undefined){
                canvases.appendChild(drawSystem (div, c3, true))
            }
            
            return canvases // list 
        }
    }

    function drawPlanet (planet,g,gt,ctx,g2) {
        if(planet.isPlanet){
            var name = "Salibe";
            if(planet.atmothickness > 0.01){
            if(planet.atmobasegas == "carbondioxide"){
                image(imageobjs["img/ATM_carbo.png"],(g/gt)*3300+250,g2,((radius(planet)**0.33)*4),ctx);
            } else{
                image(imageobjs["img/ATM_nitro.png"],(g/gt)*3300+250,g2,((radius(planet)**0.33)*4),ctx);
            }
        }

        if(planet.gas > Number.EPSILON){
            if(planet.ice <= Number.EPSILON){
                image(imageobjs["img/planeticons/gasGiant.png"],(g/gt)*3300+250,g2,((radius(planet)**0.33)*2),ctx);
            } else{
                image(imageobjs["img/planeticons/iceGiant.png"],(g/gt)*3300+250,g2,((radius(planet)**0.33)*2),ctx);
            }
        } else {
            if(planet.ice <= Number.EPSILON){
                image(imageobjs["img/planeticons/rockyPlanet.png"],(g/gt)*3300+250,g2,((radius(planet)**0.33)*2),ctx);
            } else{
                image(imageobjs["img/planeticons/icyPlanet.png"],(g/gt)*3300+250,g2,((radius(planet)**0.33)*2),ctx);
            }
        }
        if(planet.life == 2 && planet.lifeLocation == "surface"){
            image(imageobjs["img/planeticons/lifeOverlayWater.png"],(g/gt)*3300+250,g2,((radius(planet)**0.33)*2),ctx);
        }
        if(planet.liquidCoverage > 0.0001){
            if(planet.liquid == 0){
                if(planet.liquidCoverage == 1){
                    image(imageobjs["img/planeticons/waterOverlay3.png"],(g/gt)*3300+250,g2,((radius(planet)**0.33)*2),ctx);
                }else if(planet.liquidCoverage > 0.5){
                    image(imageobjs["img/planeticons/waterOverlay2.png"],(g/gt)*3300+250,g2,((radius(planet)**0.33)*2),ctx);
                }else {
                    image(imageobjs["img/planeticons/waterOverlay1.png"],(g/gt)*3300+250,g2,((radius(planet)**0.33)*2),ctx);
                }
                
            } else{
                if(planet.liquidCoverage == 1){
                    image(imageobjs["img/planeticons/methaneOverlay3.png"],(g/gt)*3300+250,g2,((radius(planet)**0.33)*2),ctx);
                }else if(planet.liquidCoverage > 0.5){
                    image(imageobjs["img/planeticons/methaneOverlay2.png"],(g/gt)*3300+250,g2,((radius(planet)**0.33)*2),ctx);
                }else {
                    image(imageobjs["img/planeticons/methaneOverlay1.png"],(g/gt)*3300+250,g2,((radius(planet)**0.33)*2),ctx);
                }
            }
        }
        image(imageobjs["img/planeticons/shade.png"],(g/gt)*3300+250,g2,((radius(planet)**0.33)*2),ctx);
        ctx.save();
        ctx.fillStyle="rgb(255,255,255)";
        ctx.font=Math.min(Math.max(Math.ceil(radius(planet)**0.33),20),40)+ "px Comfortaa"
        ctx.translate((g/gt)*3300+250,g2);
        ctx.rotate(-Math.PI/4);
        ctx.textAlign="left";
        if(planet.name != undefined){ctx.fillText(planet.name,((radius(planet)**0.33)*1)+10,0);}else{ctx.fillText("Salibe",((radius(planet)**0.33)*1)+10,0);}
        ctx.restore();
        } else {
           
            if(mass(planet) <= 0.4){
                image(imageobjs["img/staricons/typem.png"],(g/gt)*3300+250,g2,((radius(planet)**0.33)*6),ctx);
            } else if(mass(planet) <= 0.8){
                image(imageobjs["img/staricons/typek.png"],(g/gt)*3300+250,g2,((radius(planet)**0.33)*6),ctx);
            }else if(mass(planet) <= 1.04){
                image(imageobjs["img/staricons/typeg.png"],(g/gt)*3300+250,g2,((radius(planet)**0.33)*6),ctx);
            }else if(mass(planet) <= 1.4){
                image(imageobjs["img/staricons/typef.png"],(g/gt)*3300+250,g2,((radius(planet)**0.33)*6),ctx);
            }else if(mass(planet) <= 2.1){
                image(imageobjs["img/staricons/typea.png"],(g/gt)*3300+250,g2,((radius(planet)**0.33)*6),ctx);
            }else if(mass(planet) <= 999){
                image(imageobjs["img/staricons/typeb.png"],(g/gt)*3300+250,g2,((radius(planet)**0.33)*6),ctx);
            }else;
            ctx.save();
        ctx.fillStyle="rgb(255,255,255)";
        ctx.font=Math.min(Math.max(Math.ceil(radius(planet)**0.25)*2,30),50)+ "px Comfortaa"
        ctx.translate((g/gt)*3300+250,g2);
        ctx.rotate(-Math.PI/4);
        ctx.textAlign="left";
        if(planet.name != undefined){ctx.fillText(planet.name,((radius(planet)**0.33)*1)+10,0);} else {ctx.fillText("Salibe",((radius(planet)**0.33)*1)+10,0);}
        
        ctx.restore();
        }
        

    }
    
    /*
    function drawSystem (div, star, sub = false){
        tempCanvas = new canvas
        canvases = []

        for (everything orbiting the main star) {
    
            is it a planet? {
                draw the planet (each planet is the distance of the previous planet + constant value + difference between their actual orbital distances, logarithmic)
                for (everything orbiting the planet) { // it's not a star; we're not in medieval Europe
                    draw the moon (moons follow a similar formula, but vertical, and down from the planet)
                }
            }
            is it a star? {
                does the star have planets? {
                canvases.push(drawSystem (same div, orbiting star, true))
                } else {
                 just draw the star smh
                }
            }
        }
            
        if (sub) {
            return tempCanvas
        } else {
            canvases.push(tempCanvas)
            return canvases // list 
        }
    }
        */










     /* OUTPUT TEXT TO DIV */

    var composition
    var field = document.getElementById("jsoneditor");
    function toggleJSONEditor(){
        
        if(field.style.display == "none"){
            field.style.display = "block";
        } else {
            field.style.display = "none";
        }

    }

    function updateSystem(){
        try {
        var div = document.createElement("div");
    div.classList.add("system");
    var test_star = JSON.retrocycle(JSON.parse(document.getElementById("jsoninput").value))
    
    var div2 = document.getElementsByClassName("systemcontainer")[0];
    div2.innerHTML = " "
    div2.appendChild(drawSystem(div,test_star,false));
    systemDataToHTML(test_star,div);
    div2.appendChild(div);
} catch (error){
    var div2 = document.getElementsByClassName("systemcontainer")[0];
     div2.innerHTML = " "
    var div = document.createElement("div");
    div.classList.add("system");
    div.innerHTML = "<p>Whoopsie! Something didn't work. Have you checked that your JSON is correct? If so, then it might be an issue with the app - notify me!</p> <hr> <p>Error: <span class='red'>"+error.message+"</span></p>"
    div2.appendChild(div);
}
    }

     function systemDataToHTML(system,div){
        div.innerHTML = ""
        aaa++;
        
        parseObjectData(system,div);
     }
     var aaa = 0;
     var bbb = 0;
     function parseObjectData(system,div){
        
        if(system.isStar){
            if(system.name == undefined){
                addline("<img class='icon2 whiteicon' src='img/iconClassG.png'>STAR: Salibe",div,"h3",true);
            }else{
                addline("<img class='icon2 whiteicon' src='img/iconClassG.png'>STAR: "+toTitleCase(system.name),div,"h3",true);
            }
            
            if(system.WD){
                var l1 = lumaToMass(system.luma);
                addline("White dwarf (mass: "+l1.toFixed(2)+"x Sun)",div,"p",true);
                addline("Main sequence luminosity: "+system.luma.toFixed(5)+"x that of the Sun",div,"p",true);
            }else{
                addline("Main sequence star",div,"p",true);
                var l1 = lumaToMass(system.luma);
                if (l1 <= 0.4){
                    addline("Spectral type: <span class='typem'>M</span> (mass: "+l1.toFixed(2)+"x Sun)",div,"p",true);
                } else if (l1 <= 0.8){
                    addline("Spectral type: <span class='typek'>K</span> (mass: "+l1.toFixed(2)+"x Sun)",div,"p",true);
                }else if (l1 <= 1.04){
                    addline("Spectral type: <span class='typeg'>G</span> (mass: "+l1.toFixed(2)+"x Sun)",div,"p",true);
                }else if (l1 <= 1.4){
                    addline("Spectral type: <span class='typef'>F</span> (mass: "+l1.toFixed(2)+"x Sun)",div,"p",true);
                }else if (l1 <= 2.1){
                    addline("Spectral type: <span class='typea'>A</span> (mass: "+l1.toFixed(2)+"x Sun)",div,"p",true);
                }else{
                    addline("Spectral type: <span class='typeb'>B</span> (mass: "+l1.toFixed(2)+"x Sun)",div,"p",true);
                }
                addline("Luminosity: " +system.luma.toFixed(5)+"x that of the Sun",div,"p",true);
                addline("Temperature: " +starTemp(system).toFixed(5)+" K",div,"p",true);
            }
            addline("Age: " +(system.age/1000).toFixed(2)+" billion years",div,"p",true);
            if(system.AUSun != undefined ){
                addline("<img class='icon whiteicon' src='img/iconDistance.png'> Distance from star: " + distanceFromParent(system).toFixed(5) + " AU ("+ system.AUSun.toFixed(3)+" AUâ˜‰)",div,"p",true)
            }
            for(let z1 = 0; z1 < system.planets.length; z1++){
                var div2 = document.createElement("div");
            div2.classList.add("system2");
            div.appendChild(div2)
                parseObjectData(sortByDistance(system.planets)[z1],div2);
            }
        } else if (system.isPlanet){
            if(system.parentbody.isStar && system.mass >= 0.01){
                if(system.name == undefined){
                addline("<img class='icon2 whiteicon' src='img/iconUberplanet.png'>MAJOR PLANET: Salibe",div,"h3",true);
            }else{
                addline("<img class='icon2 whiteicon' src='img/iconUberplanet.png'>MAJOR PLANET: "+toTitleCase(system.name),div,"h3",true);
            }
                addline("<img class='icon whiteicon' src='img/iconDistance.png'> Distance from star: " + distanceFromParent(system).toFixed(5) + " AU ("+ system.AUSun.toFixed(3)+" AUâ˜‰)",div,"p",true)
                if(system.parentbody.planets[0].isStar && system.parentbody.planets[0].AUSun <= 0.3){
                    var carykh = lumaToMass(system.parentbody.luma)+lumaToMass(system.parentbody.planets[0].luma)
                } else {
                    var carykh = lumaToMass(system.parentbody.luma)
                }
                addline("<img class='icon whiteicon' src='img/iconSystem.png'> Year: " + (OrbitToYear(distanceFromParent(system),carykh)*365).toFixed(2) + " days",div,"p",true)
            } else if(!(system.parentbody.isStar)){
                if(system.name == undefined){
                addline("<img class='icon2 whiteicon' src='img/iconSatellite.png'>SATELLITE PLANET: Salibe",div,"h3",true);
            }else{
                addline("<img class='icon2 whiteicon' src='img/iconSatellite.png'>SATELLITE PLANET: "+toTitleCase(system.name),div,"h3",true);
            }
                addline("<img class='icon whiteicon' src='img/iconDistance.png'> Distance from planet: " + distanceFromParent(system).toFixed(5) + " AU",div,"p",true)
                addline("<img class='icon whiteicon' src='img/iconSystem.png'> Month: " + (OrbitToYear(distanceFromParent(system),system.parentbody.mass/333000)*365).toFixed(2) + " days",div,"p",true)
            } else {
                if(system.name == undefined){
                addline("<img class='icon2 whiteicon' src='img/iconUnterplanet.png'>DWARF PLANET: Salibe",div,"h3",true);
            }else{
                addline("<img class='icon2 whiteicon' src='img/iconUnterplanet.png'>DWARF PLANET: "+toTitleCase(system.name),div,"h3",true);
            }
                addline("<img class='icon whiteicon' src='img/iconDistance.png'> Distance from star: " + distanceFromParent(system).toFixed(5) + " AU ("+ system.AUSun.toFixed(3)+" AUâ˜‰)",div,"p",true)
                if(system.parentbody.planets[0].isStar && system.parentbody.planets[0].AUSun <= 0.3){
                    var carykh = lumaToMass(system.parentbody.luma)+lumaToMass(system.parentbody.planets[0].luma)
                } else {
                    var carykh = lumaToMass(system.parentbody.luma)
                }
                addline("<img class='icon whiteicon' src='img/iconSystem.png'> Year: " + (OrbitToYear(distanceFromParent(system),carykh)*365).toFixed(2) + " days",div,"p",true)
            }
            addline("<img class='icon whiteicon' src='img/iconMass.png'> Mass: " + system.mass.toFixed(6) +  "x Earth",div,"p",true)
            addline("<img class='icon whiteicon' src='img/iconRadius.png'> Radius: " + radius(system).toFixed(1) + " km (" + (radius(system)/6371).toFixed(3)+"x Earth)",div,"p",true)
            addline("<img class='icon whiteicon' src='img/iconComposition.png'> Density: " + density(system).toFixed(1) +  "g/cmÂ³",div,"p",true)
            addline("<img class='icon whiteicon' src='img/iconGravity.png'> Surface gravity: " + ((system.mass*9.8)/((radius(system)/6371)**2)).toFixed(1) +  " m/sÂ²",div,"p",true)
            if(system.gas > 0){
                if(system.ice > 0){
                    addline("<img class='icon whiteicon' src='img/iconComposition.png'> Is a <img class='icon' src='img/iconIceGiant.png'> <span class='icegiant'> ice giant</span> ("+(system.gas*100).toFixed(0)+"% gas, "+(system.ice*100).toFixed(0)+"% ice, "+(system.rock*100).toFixed(0)+"% rock, "+(system.metal*100).toFixed(0)+"% metal)",div,"p",true)
                } else {
                    addline("<img class='icon whiteicon' src='img/iconComposition.png'> Is a <img class='icon' src='img/iconGasGiant.png'> <span class='gasgiant'> gas giant</span> ("+(system.gas*100).toFixed(0)+"% gas, "+(system.rock*100).toFixed(0)+"% rock, "+(system.metal*100).toFixed(0)+"% metal)",div,"p",true)
                }
            } else {
                if(system.ice > 0){
                    addline("<img class='icon whiteicon' src='img/iconComposition.png'> Composition: <img class='icon' src='img/iconIcy.png'> <span class='icy'> icy</span> ("+(system.ice*100).toFixed(0)+"% ice, "+(system.rock*100).toFixed(0)+"% rock, "+(system.metal*100).toFixed(0)+"% metal)",div,"p",true)
                } else {
                    if (system.metal > 0.6){
                        addline("<img class='icon whiteicon' src='img/iconComposition.png'> Composition: <img class='icon' src='img/iconMetallic.png'> <span class='metallic'> metallic</span> ("+(system.rock*100).toFixed(0)+"% rock, "+(system.metal*100).toFixed(0)+"% metal)",div,"p",true)
                    } else {
                        addline("<img class='icon whiteicon' src='img/iconComposition.png'> Composition: <img class='icon' src='img/iconRocky.png'> <span class='rocky'> rocky</span> ("+(system.rock*100).toFixed(0)+"% rock, "+(system.metal*100).toFixed(0)+"% metal)",div,"p",true)
                    }
                }
            }
            if(baseTemperature(system)<100){
                addline("<img class='icon whiteicon' src='img/iconTemperature.png'> Base temperature: <img class='icon' src='img/iconTemp1.png'><span class='purple'>" + baseTemperature(system).toFixed(0) + " Kelvin ("+ (baseTemperature(system)-273).toFixed(0) + " Celsius)</span>",div,"p",true)
            } else
            if(baseTemperature(system)<173){
                addline("<img class='icon whiteicon' src='img/iconTemperature.png'> Base temperature: <img class='icon' src='img/iconTemp2.png'><span class='blue'>" + baseTemperature(system).toFixed(0) + " Kelvin ("+ (baseTemperature(system)-273).toFixed(0) + " Celsius)</span>",div,"p",true)
            } else
            if(baseTemperature(system)<250){
                addline("<img class='icon whiteicon' src='img/iconTemperature.png'> Base temperature: <img class='icon' src='img/iconTemp3.png'><span class='lightblue'>" + baseTemperature(system).toFixed(0) + " Kelvin ("+ (baseTemperature(system)-273).toFixed(0) + " Celsius)</span>",div,"p",true)
            }  else
            if(baseTemperature(system)<320){
                addline("<img class='icon whiteicon' src='img/iconTemperature.png'> Base temperature: <img class='icon' src='img/iconTemp4.png'><span class='lightgreen'>" + baseTemperature(system).toFixed(0) + " Kelvin ("+ (baseTemperature(system)-273).toFixed(0) + " Celsius)</span>",div,"p",true)
            }else
            if(baseTemperature(system)<400){
                addline("<img class='icon whiteicon' src='img/iconTemperature.png'> Base temperature: <img class='icon' src='img/iconTemp5.png'><span class='yellow'>" + baseTemperature(system).toFixed(0) + " Kelvin ("+ (baseTemperature(system)-273).toFixed(0) + " Celsius)</span>",div,"p",true)
            }else
            if(baseTemperature(system)<550){
                addline("<img class='icon whiteicon' src='img/iconTemperature.png'> Base temperature: <img class='icon' src='img/iconTemp6.png'><span class='orange'>" + baseTemperature(system).toFixed(0) + " Kelvin ("+ (baseTemperature(system)-273).toFixed(0) + " Celsius)</span>",div,"p",true)
            }else {
                addline("<img class='icon whiteicon' src='img/iconTemperature.png'> Base temperature: <img class='icon' src='img/iconTemp7.png'><span class='red'>" + baseTemperature(system).toFixed(0) + " Kelvin ("+ (baseTemperature(system)-273).toFixed(0) + " Celsius)</span>",div,"p",true)
            }

            if(system.atmothickness > 0 ){
                if(planetTemp(system) != undefined){
                if(planetTemp(system)<100){
                addline("<img class='icon whiteicon' src='img/iconTemperature.png'> Temperature: <img class='icon' src='img/iconTemp1.png'><span class='purple'>" + planetTemp(system).toFixed(0) + " Kelvin ("+ (planetTemp(system)-273).toFixed(0) + " Celsius, "+lowTemp(system).toFixed(0) + "K "+ (lowTemp(system)-273).toFixed(0) +"C low, "+highTemp(system).toFixed(0) + "K "+ (highTemp(system)-273).toFixed(0) +"C high)</span>",div,"p",true)
            } else
            if(planetTemp(system)<173){
                addline("<img class='icon whiteicon' src='img/iconTemperature.png'> Temperature: <img class='icon' src='img/iconTemp2.png'><span class='blue'>" + planetTemp(system).toFixed(0) + " Kelvin ("+ (planetTemp(system)-273).toFixed(0) + " Celsius, "+lowTemp(system).toFixed(0) + "K "+ (lowTemp(system)-273).toFixed(0) +"C low, "+highTemp(system).toFixed(0) + "K "+ (highTemp(system)-273).toFixed(0) +"C high)</span>",div,"p",true)
            } else
            if(planetTemp(system)<250){
                addline("<img class='icon whiteicon' src='img/iconTemperature.png'> Temperature: <img class='icon' src='img/iconTemp3.png'><span class='lightblue'>" + planetTemp(system).toFixed(0) + " Kelvin ("+ (planetTemp(system)-273).toFixed(0) + " Celsius, "+lowTemp(system).toFixed(0) + "K "+ (lowTemp(system)-273).toFixed(0) +"C low, "+highTemp(system).toFixed(0) + "K "+ (highTemp(system)-273).toFixed(0) +"C high)</span>",div,"p",true)
            }  else
            if(planetTemp(system)<320){
                addline("<img class='icon whiteicon' src='img/iconTemperature.png'> Temperature: <img class='icon' src='img/iconTemp4.png'><span class='lightgreen'>" + planetTemp(system).toFixed(0) + " Kelvin ("+ (planetTemp(system)-273).toFixed(0) + " Celsius, "+lowTemp(system).toFixed(0) + "K "+ (lowTemp(system)-273).toFixed(0) +"C low, "+highTemp(system).toFixed(0) + "K "+ (highTemp(system)-273).toFixed(0) +"C high)</span>",div,"p",true)
            }else
            if(planetTemp(system)<400){
                addline("<img class='icon whiteicon' src='img/iconTemperature.png'> Temperature: <img class='icon' src='img/iconTemp5.png'><span class='yellow'>" + planetTemp(system).toFixed(0) + " Kelvin ("+ (planetTemp(system)-273).toFixed(0) + " Celsius, "+lowTemp(system).toFixed(0) + "K "+ (lowTemp(system)-273).toFixed(0) +"C low, "+highTemp(system).toFixed(0) + "K "+ (highTemp(system)-273).toFixed(0) +"C high)</span>",div,"p",true)
            }else
            if(planetTemp(system)<550){
                addline("<img class='icon whiteicon' src='img/iconTemperature.png'> Temperature: <img class='icon' src='img/iconTemp6.png'><span class='orange'>" + planetTemp(system).toFixed(0) + " Kelvin ("+ (planetTemp(system)-273).toFixed(0) + " Celsius, "+lowTemp(system).toFixed(0) + "K "+ (lowTemp(system)-273).toFixed(0) +"C low, "+highTemp(system).toFixed(0) + "K "+ (highTemp(system)-273).toFixed(0) +"C high)</span>",div,"p",true)
            }else {
                addline("<img class='icon whiteicon' src='img/iconTemperature.png'> Temperature: <img class='icon' src='img/iconTemp7.png'><span class='red'>" + planetTemp(system).toFixed(0) + " Kelvin ("+ (planetTemp(system)-273).toFixed(0) + " Celsius, "+lowTemp(system).toFixed(0) + "K "+ (lowTemp(system)-273).toFixed(0) +"C low, "+highTemp(system).toFixed(0) + "K "+ (highTemp(system)-273).toFixed(0) +"C high)</span>",div,"p",true)
            }
            }
            addline("<img class='icon whiteicon' src='img/iconAtmosphere.png'> Atmosphere thickness: <img class='icon' src='img/iconAtmo4.png'><span class=lightblue>"+(system.atmothickness*100).toFixed(0)+"%</span> that of Earth's atmosphere, contributing to a <span class='orange'>"+((system.greenhouseEffect-1)*100).toFixed(0)+"%</span> increase in temperature",div,"p",true)
            if(system.atmobasegas=="carbondioxide"){
                addline("<img class='icon whiteicon' src='img/iconAtmosphere.png'> Atmosphere is primarily <img class='icon' src='img/iconCarbonDioxide.png'><span class=orange>carbon dioxide</span>",div,"p",true)
            }else{
                addline("<img class='icon whiteicon' src='img/iconAtmosphere.png'> Atmosphere is primarily <img class='icon' src='img/iconNitrogen.png'><span class=lightblue>nitrogen</span>",div,"p",true)
                
            }
            
            if(system.liquidCoverage > 0){
                if(system.liquid == 0){
                    addline("<img class='icon whiteicon' src='img/iconLiquid.png'> Liquid: <img class='icon' src='img/iconWater.png'><span class=blue> water </span>, covering "+(system.liquidCoverage*100).toFixed(0)+"% of the surface",div,"p",true);
                    bbb++;
                    
                    if(lowTemp(system)<water.melting){
                        addline("<img class='icon whiteicon' src='img/iconIcy.png'> Has ice caps",div,"p",true);
                    }
                }else 
                if(system.liquid == 1){
                    addline("<img class='icon whiteicon' src='img/iconLiquid.png'> Liquid: <img class='icon' src='img/iconMethanum.png'><span class=lightgray> methanum </span>, covering "+(system.liquidCoverage*100).toFixed(0)+"% of the surface",div,"p",true)
                    if(lowTemp(system)<methanum.melting){
                        addline("<img class='icon whiteicon' src='img/iconIcy.png'> Has ice caps",div,"p",true);
                    }
                }
            }

            
        }
        if(system.gas == 0){
            if(system.geoactive){
                addline("<img class='icon whiteicon' src='img/iconActivity.png'> Geologically active: YES",div,"p",true)
            }else{
                addline("<img class='icon whiteicon' src='img/iconActivity.png'> Geologically active: NO",div,"p",true)
            }
            if(system.life > 0){
                
                if(system.life == 1){
                    addline("<img class='icon whiteicon' src='img/iconLife.png'> Life: <img class='icon' src='img/iconProkaryotic.png'><span class='purple'> precambrian </span> ("+system.lifeLocation+")",div,"p",true)
                }else{
                    addline("<img class='icon whiteicon' src='img/iconLife.png'> Life: <img class='icon' src='img/iconMulticellular.png'><span class='purple'> phanerozoic </span> ("+system.lifeLocation+")",div,"p",true)
                }
            }
            if(system.civ){
                addline("<img class='icon whiteicon' src='img/iconCivilization.png'><span class='purple'> Is a homeworld </span> ",div,"p",true)
            }
        }
            

            
            
            if(system.moons.length >= 0){
                for(let z1 = 0; z1 < system.moons.length; z1++){
                var div2 = document.createElement("div");
            div2.classList.add("system2");
            div.appendChild(div2)
                parseObjectData(sortByDistance(system.moons)[z1],div2);
            }
            }

        }
     }
     function addline(text,parent,style = "p",html=false) {
    var txt3 = document.createElement(style); 

    if(html){
        txt3.innerHTML = (text);
    }else{
        txt3.textContent = (text);

    }

    parent.appendChild(txt3);
    return(txt3);
}
        
           
            
       /* VISUAL CODE */

           
    function add_image_to_list(imglist, imgsrc) {
  var myimg = new Image();
  var myfulfill; var myreject;
  var mypromise = new Promise((ff, rj) => {myfulfill=ff;myreject=rj;});
  myimg.src = imgsrc;
  myimg.onload = function () {myfulfill(1);};
  myimg.onerror = myreject;
  imglist.push(myimg);
  return mypromise;
}
function add_image_to_list2(imglist, imgsrc) {
  var myimg = new Image();
  var myfulfill; var myreject;
  var mypromise = new Promise((ff, rj) => {myfulfill=ff;myreject=rj;});
  myimg.src = imgsrc;
  myimg.onload = function () {myfulfill(1);};
  myimg.onerror = myreject;
  imglist[imgsrc]=myimg;
  return mypromise;
}
function drawCircle(color,x,y,radius,ctx){
    ctx.fillStyle = color;
        ctx.beginPath();
        ctx.arc(x,y,radius,0,6.28);
        ctx.fill();
        ctx.closePath();
}
function image(img,x,y,scale,ctx){
    ctx.drawImage(img,x-(scale/2),y-(scale/2),scale,scale);
}
function Test2(){
    var canvas = document.createElement("canvas");
    var canvascontainer = document.createElement("div");
    canvascontainer.appendChild(canvas);
    canvascontainer.setAttribute("style","position:relative;width:100%;aspect-ratio:37/13;margin-bottom:0px;margin-top:0px;");
    var canvas2;
    canvas.setAttribute("width","3700");
    canvas.setAttribute("height","1300");
    canvas.classList.add("systemdisplay");
    var ctx = canvas.getContext("2d");
    ctx.imageSmoothingQuality="high";
    ctx.fillStyle = "rgb(0,255,0)";
    ctx.fillStyle = "rgb(0,255,0)";
    for(let aj = 0; aj < 100; aj++){
        drawCircle("#ffffff4f",Math.round(Math.random()*3700),Math.round(Math.random()*1300),2,ctx);
    }   
            
}

function refreshSystem(id){
    systemdivs[id]=(displaySystem(id));
    if(id>=page*10&&id<=(page+1)*10) {
        syscont=document.getElementsByClassName("systemcontainer")[0];
        while (syscont.hasChildNodes()) {
    syscont.removeChild(syscont.firstChild);
}
    systemcontainerinterior.innerHTML = "";
    document.getElementById("pagenumber").innerText = "Page "+(page+1);
    for(let ac = page*10; ac < (page*10)+10; ac++){
        if(systemdivs[ac]){
            systemcontainerinterior.appendChild(systemdivs[ac]);
        }

    }
    syscont.appendChild(systemcontainerinterior);
    }
}
var page;
function GenerateSystemLoopWrapper(){
    
    document.getElementsByClassName("progress")[0].textContent = ((inc+1)+"/"+maxinc); // progress bar? 
        generateSystem(); // !!!
        inc++; // !!!
        systemdivs.push(displaySystem(inc-1)); // !!!
    if(inc < maxinc){ // !!!
        setTimeout(GenerateSystemLoopWrapper,1);
        
    }else{
        page=0;
    document.getElementById("pagenumber").innerText = "Page "+(page+1);

    for(let ac = page*10; ac < (page*10)+10; ac++){
        if(systemdivs[ac]){
            systemcontainerinterior.appendChild(systemdivs[ac]);
        }
    }
    syscont.appendChild(systemcontainerinterior);
    }
    
}

function generateSystem(){
    seed=seed%491041798642919;
    var seedtemp = seed;
    var test_star = generateStar(0.08,0.1);
    placePlanetsNonResonant(test_star);

    return(test_star);
}

document.addEventListener('DOMContentLoaded', Initialize);

/* CYCLE.JS */

/*
    cycle.js
    2021-05-31

    Public Domain.

    NO WARRANTY EXPRESSED OR IMPLIED. USE AT YOUR OWN RISK.

    This code should be minified before deployment.
    See https://www.crockford.com/jsmin.html

    USE YOUR OWN COPY. IT IS EXTREMELY UNWISE TO LOAD CODE FROM SERVERS YOU DO
    NOT CONTROL.
*/

// The file uses the WeakMap feature of ES6.

/*jslint eval */

/*property
    $ref, decycle, forEach, get, indexOf, isArray, keys, length, push,
    retrocycle, set, stringify, test
*/

if (typeof JSON.decycle !== "function") {
    JSON.decycle = function decycle(object, replacer) {
        "use strict";

// Make a deep copy of an object or array, assuring that there is at most
// one instance of each object or array in the resulting structure. The
// duplicate references (which might be forming cycles) are replaced with
// an object of the form

//      {"$ref": PATH}

// where the PATH is a JSONPath string that locates the first occurance.

// So,

//      var a = [];
//      a[0] = a;
//      return JSON.stringify(JSON.decycle(a));

// produces the string '[{"$ref":"$"}]'.

// If a replacer function is provided, then it will be called for each value.
// A replacer function receives a value and returns a replacement value.

// JSONPath is used to locate the unique object. $ indicates the top level of
// the object or array. [NUMBER] or [STRING] indicates a child element or
// property.

        var objects = new WeakMap();     // object to path mappings

        return (function derez(value, path) {

// The derez function recurses through the object, producing the deep copy.

            var old_path;   // The path of an earlier occurance of value
            var nu;         // The new object or array

// If a replacer function was provided, then call it to get a replacement value.

            if (replacer !== undefined) {
                value = replacer(value);
            }

// typeof null === "object", so go on if this value is really an object but not
// one of the weird builtin objects.

            if (
                typeof value === "object"
                && value !== null
                && !(value instanceof Boolean)
                && !(value instanceof Date)
                && !(value instanceof Number)
                && !(value instanceof RegExp)
                && !(value instanceof String)
            ) {

// If the value is an object or array, look to see if we have already
// encountered it. If so, return a {"$ref":PATH} object. This uses an
// ES6 WeakMap.

                old_path = objects.get(value);
                if (old_path !== undefined) {
                    return {$ref: old_path};
                }

// Otherwise, accumulate the unique value and its path.

                objects.set(value, path);

// If it is an array, replicate the array.

                if (Array.isArray(value)) {
                    nu = [];
                    value.forEach(function (element, i) {
                        nu[i] = derez(element, path + "[" + i + "]");
                    });
                } else {

// If it is an object, replicate the object.

                    nu = {};
                    Object.keys(value).forEach(function (name) {
                        nu[name] = derez(
                            value[name],
                            path + "[" + JSON.stringify(name) + "]"
                        );
                    });
                }
                return nu;
            }
            return value;
        }(object, "$"));
    };
}


if (typeof JSON.retrocycle !== "function") {
    JSON.retrocycle = function retrocycle($) {
        "use strict";

// Restore an object that was reduced by decycle. Members whose values are
// objects of the form
//      {$ref: PATH}
// are replaced with references to the value found by the PATH. This will
// restore cycles. The object will be mutated.

// The eval function is used to locate the values described by a PATH. The
// root object is kept in a $ variable. A regular expression is used to
// assure that the PATH is extremely well formed. The regexp contains nested
// * quantifiers. That has been known to have extremely bad performance
// problems on some browsers for very long strings. A PATH is expected to be
// reasonably short. A PATH is allowed to belong to a very restricted subset of
// Goessner's JSONPath.

// So,
//      var s = '[{"$ref":"$"}]';
//      return JSON.retrocycle(JSON.parse(s));
// produces an array containing a single element which is the array itself.

        var px = /^\$(?:\[(?:\d+|"(?:[^\\"\u0000-\u001f]|\\(?:[\\"\/bfnrt]|u[0-9a-zA-Z]{4}))*")\])*$/;

        (function rez(value) {

// The rez function walks recursively through the object looking for $ref
// properties. When it finds one that has a value that is a path, then it
// replaces the $ref object with a reference to the value that is found by
// the path.

            if (value && typeof value === "object") {
                if (Array.isArray(value)) {
                    value.forEach(function (element, i) {
                        if (typeof element === "object" && element !== null) {
                            var path = element.$ref;
                            if (typeof path === "string" && px.test(path)) {
                                value[i] = eval(path);
                            } else {
                                rez(element);
                            }
                        }
                    });
                } else {
                    Object.keys(value).forEach(function (name) {
                        var item = value[name];
                        if (typeof item === "object" && item !== null) {
                            var path = item.$ref;
                            if (typeof path === "string" && px.test(path)) {
                                value[name] = eval(path);
                            } else {
                                rez(item);
                            }
                        }
                    });
                }
            }
        }($));
        return $;
    };
}







    </script>
  </body>
</html>
